<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>喃声细语</title>
  <subtitle>开始</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.wuwii.com/"/>
  <updated>2017-09-12T10:16:46.569Z</updated>
  <id>http://blog.wuwii.com/</id>
  
  <author>
    <name>张 凯</name>
    <email>k@wuwii.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MQTT在JAVA中使用</title>
    <link href="http://blog.wuwii.com/java-mqtt.html"/>
    <id>http://blog.wuwii.com/java-mqtt.html</id>
    <published>2017-09-12T10:08:03.000Z</published>
    <updated>2017-09-12T10:16:46.569Z</updated>
    
    <content type="html"><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><blockquote>
<p>由于项目中需求，多个客户机终端不断发送位置给服务机，服务机根据消息，准确判断信息，并返回响应，回复该客户机。</p>
</blockquote>
<p>在这里我们的服务机，不但要订阅所有客户机的主题，还要根据客户机消息做出相应的响应，服务机同时充当客户机使用，客户机也推送主题消息，充当服务器。<br><a id="more"></a> </p>
<blockquote>
<p>关键问题：</p>
<ol>
<li>服务器怎么区分各个客户机</li>
<li>主题配置方面的问题，不可能每个机器配个主题</li>
<li>通信方面，选择哪种消息级别</li>
</ol>
</blockquote>
<h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><h4 id="使用maven项目，刚好在仓库导包了，可以使用（推荐）"><a href="#使用maven项目，刚好在仓库导包了，可以使用（推荐）" class="headerlink" title="使用maven项目，刚好在仓库导包了，可以使用（推荐）"></a>使用maven项目，刚好在仓库导包了，可以使用（推荐）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.eclipse.paho<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.eclipse.paho.client.mqttv3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="仓库没有包，直接去网上下，可以直接导包到Lib中"><a href="#仓库没有包，直接去网上下，可以直接导包到Lib中" class="headerlink" title="仓库没有包，直接去网上下，可以直接导包到Lib中"></a>仓库没有包，直接去网上下，可以直接导包到Lib中</h4><h3 id="编写"><a href="#编写" class="headerlink" title="编写"></a>编写</h3><h4 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.devframe.mqtt.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttClient;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttConnectOptions;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttException;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"><span class="comment">* <span class="doctag">@ClassName</span>: ServerMQTT </span></div><div class="line"><span class="comment">* <span class="doctag">@Description</span>:  服务器接收多个客户端的主题，同时要像客户端反馈</span></div><div class="line"><span class="comment">* <span class="doctag">@author</span> zhangkai </span></div><div class="line"><span class="comment">* <span class="doctag">@date</span> 2017年9月12日 下午12:52:01 </span></div><div class="line"><span class="comment">*  </span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerMQTT</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">// 连接参数</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_STRING = <span class="string">"tcp://192.168.19.200:8001"</span>; <span class="comment">//host</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">boolean</span> CLEAN_START = <span class="keyword">true</span>;  <span class="comment">//是否清空session，false保留</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">short</span> KEEP_ALIVE = <span class="number">30</span>;<span class="comment">// 低耗网络，但是又需要及时获取数据，心跳30*1.5s</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">short</span> KEEP_TIME_OUT = <span class="number">10</span>; <span class="comment">//连接超时</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CLIENT_ID = <span class="string">"master"</span>;<span class="comment">// 客户端标识</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span>[] QOS_VALUES = &#123; <span class="number">0</span> &#125;;<span class="comment">// 对应主题的消息级别</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String[] TOPICS = &#123; <span class="string">"agri/#"</span>&#125;; <span class="comment">//匹配agri/下所有的主题</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String userName = <span class="string">"agri"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String passWord = <span class="string">"admin@123"</span>;</div><div class="line">	<span class="keyword">private</span> MqttConnectOptions options;</div><div class="line">	<span class="keyword">private</span> MqttClient mqttClient;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 构造函数</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@throws</span> MqttException</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ServerMQTT</span><span class="params">()</span> <span class="keyword">throws</span> MqttException </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 发送消息</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> topic 主题</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> message 消息</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> qos 消息级别&#123;0,1,2&#125;</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> retained 是否是实时发送的消息(false=实时，true=服务器上保留的最后消息)</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String topic, String message, <span class="keyword">int</span> qos, <span class="keyword">boolean</span> retained)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//断开重连</span></div><div class="line">			<span class="keyword">if</span> (mqttClient == <span class="keyword">null</span> || !mqttClient.isConnected()) &#123;</div><div class="line">				connect();</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// 发布消息</span></div><div class="line">			mqttClient.publish(topic, message.getBytes(), qos, retained);</div><div class="line">		&#125; <span class="keyword">catch</span> (MqttException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 重新连接服务</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			mqttClient = <span class="keyword">new</span> MqttClient(CONNECTION_STRING, CLIENT_ID, <span class="keyword">new</span> MemoryPersistence());</div><div class="line">			<span class="comment">// MQTT的连接设置</span></div><div class="line">			options = <span class="keyword">new</span> MqttConnectOptions();</div><div class="line">			<span class="comment">// 设置是否清空session,这里如果设置为false表示服务器会保留客户端的连接记录，这里设置为true表示每次连接到服务器都以新的身份连接</span></div><div class="line">			options.setCleanSession(CLEAN_START);</div><div class="line">			<span class="comment">// 设置连接的用户名</span></div><div class="line">			options.setUserName(userName);</div><div class="line">			<span class="comment">// 设置连接的密码</span></div><div class="line">			options.setPassword(passWord.toCharArray());</div><div class="line">			<span class="comment">// 设置超时时间 单位为秒</span></div><div class="line">			options.setConnectionTimeout(KEEP_TIME_OUT);</div><div class="line">			<span class="comment">// 设置会话心跳时间 单位为秒 服务器会每隔1.5*30秒的时间向客户端发送个消息判断客户端是否在线，但这个方法并没有重连的机制</span></div><div class="line">			options.setKeepAliveInterval(KEEP_ALIVE); </div><div class="line">			<span class="comment">// 设置回调</span></div><div class="line">			mqttClient.setCallback(<span class="keyword">new</span> PushCallback());</div><div class="line"></div><div class="line">			mqttClient.connect(options);</div><div class="line">			mqttClient.subscribe( TOPICS , QOS_VALUES);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 启动入口</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> args</span></div><div class="line"><span class="comment">	 * <span class="doctag">@throws</span> MqttException</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MqttException </span>&#123;</div><div class="line">		ServerMQTT server = <span class="keyword">new</span> ServerMQTT();</div><div class="line">		server.connect();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="客户机"><a href="#客户机" class="headerlink" title="客户机"></a>客户机</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.devframe.mqtt.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.ScheduledExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttClient;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttConnectOptions;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttException;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttSecurityException;</div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.persist.MemoryPersistence;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientMQTT</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">// 连接参数</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONNECTION_STRING = <span class="string">"tcp://192.168.19.200:8001"</span>; <span class="comment">// host</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">boolean</span> CLEAN_START = <span class="keyword">true</span>; <span class="comment">// 是否清空session，false保留</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">short</span> KEEP_ALIVE = <span class="number">30</span>;<span class="comment">// 低耗网络，但是又需要及时获取数据，心跳30*1.5s</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">short</span> KEEP_TIME_OUT = <span class="number">10</span>; <span class="comment">// 连接超时</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String CLIENT_ID = <span class="string">"client1"</span>;<span class="comment">// 客户端标识</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span>[] QOS_VALUES = &#123; <span class="number">0</span> &#125;;<span class="comment">// 对应主题的消息级别</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String PUBLISH_TOPIC = <span class="string">"agri/index1"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String[] RECEIVE_TOPIC = &#123;<span class="string">"agri/index1/back"</span>&#125;;</div><div class="line">	<span class="keyword">private</span> MqttClient client;</div><div class="line">	<span class="keyword">private</span> MqttConnectOptions options;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String userName = <span class="string">"agri"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">final</span> String passWord = <span class="string">"admin@123"</span>;</div><div class="line">	<span class="keyword">private</span> ScheduledExecutorService scheduler;</div><div class="line"></div><div class="line">	<span class="comment">// 重新连接</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startReconnect</span><span class="params">()</span> </span>&#123;</div><div class="line">		scheduler = Executors.newSingleThreadScheduledExecutor();</div><div class="line">		scheduler.scheduleAtFixedRate(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">				<span class="keyword">if</span> (!client.isConnected()) &#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						client.connect(options);</div><div class="line">					&#125; <span class="keyword">catch</span> (MqttSecurityException e) &#123;</div><div class="line">						e.printStackTrace();</div><div class="line">					&#125; <span class="keyword">catch</span> (MqttException e) &#123;</div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;, <span class="number">0</span> * <span class="number">1000</span>, <span class="number">10</span> * <span class="number">1000</span>, TimeUnit.MILLISECONDS);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 发送消息</span></div><div class="line"><span class="comment">	 * </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> topic</span></div><div class="line"><span class="comment">	 *            主题</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> message</span></div><div class="line"><span class="comment">	 *            消息</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> qos</span></div><div class="line"><span class="comment">	 *            消息级别&#123;0,1,2&#125;</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> retained</span></div><div class="line"><span class="comment">	 *            是否是实时发送的消息(false=实时，true=服务器上保留的最后消息)</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String topic, String message, <span class="keyword">int</span> qos, <span class="keyword">boolean</span> retained)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">if</span> (client == <span class="keyword">null</span> || !client.isConnected()) &#123;</div><div class="line">				connect();</div><div class="line">			&#125;</div><div class="line">			<span class="comment">// 发布消息</span></div><div class="line">			client.publish(topic, message.getBytes(), qos, retained);</div><div class="line">		&#125; <span class="keyword">catch</span> (MqttException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 重新连接服务</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			client = <span class="keyword">new</span> MqttClient(CONNECTION_STRING, CLIENT_ID, <span class="keyword">new</span> MemoryPersistence());</div><div class="line">			<span class="comment">// MQTT的连接设置</span></div><div class="line">			options = <span class="keyword">new</span> MqttConnectOptions();</div><div class="line">			<span class="comment">// 设置是否清空session,这里如果设置为false表示服务器会保留客户端的连接记录，这里设置为true表示每次连接到服务器都以新的身份连接</span></div><div class="line">			options.setCleanSession(CLEAN_START);</div><div class="line">			<span class="comment">// 设置连接的用户名</span></div><div class="line">			options.setUserName(userName);</div><div class="line">			<span class="comment">// 设置连接的密码</span></div><div class="line">			options.setPassword(passWord.toCharArray());</div><div class="line">			<span class="comment">// 设置超时时间 单位为秒</span></div><div class="line">			options.setConnectionTimeout(KEEP_TIME_OUT);</div><div class="line">			<span class="comment">// 设置会话心跳时间 单位为秒 服务器会每隔1.5*30秒的时间向客户端发送个消息判断客户端是否在线，但这个方法并没有重连的机制</span></div><div class="line">			options.setKeepAliveInterval(KEEP_ALIVE);</div><div class="line">			<span class="comment">// 设置回调</span></div><div class="line">			client.setCallback(<span class="keyword">new</span> PushCallback());</div><div class="line"></div><div class="line">			client.connect(options);</div><div class="line">			client.subscribe(RECEIVE_TOPIC, QOS_VALUES);</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// TODO 每秒一次向服务端发送消息</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">			<span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">				sendMessage(PUBLISH_TOPIC, <span class="string">"hello,topic"</span> + i, <span class="number">0</span>, <span class="keyword">true</span>);</div><div class="line">				i++;</div><div class="line">				Thread.sleep(<span class="number">1000</span>);</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MqttException </span>&#123;</div><div class="line">		ClientMQTT client = <span class="keyword">new</span> ClientMQTT();</div><div class="line">		Thread thread = <span class="keyword">new</span> Thread(client, <span class="string">"th1"</span>);</div><div class="line">		thread.start();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试的时候就是把客户机复制了几个，主题和clientid改下，clientid不能一样，不然不能登陆。</p>
<h3 id="回调类"><a href="#回调类" class="headerlink" title="回调类"></a>回调类</h3><p>发送完消息，Service需要在这里处理，着我们先做的事情啦。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.devframe.mqtt.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.IMqttDeliveryToken;  </div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttCallback;  </div><div class="line"><span class="keyword">import</span> org.eclipse.paho.client.mqttv3.MqttMessage;  </div><div class="line">  </div><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: PushCallback</span></div><div class="line"><span class="comment"> * <span class="doctag">@Description</span>: 发布消息的回调类</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> *               必须实现MqttCallback的接口并实现对应的相关接口方法CallBack 类将实现 MqttCallBack。</span></div><div class="line"><span class="comment"> *               每个客户机标识都需要一个回调实例。在此示例中，构造函数传递客户机标识以另存为实例数据。</span></div><div class="line"><span class="comment"> *               在回调中，将它用来标识已经启动了该回调的哪个实例。 必须在回调类中实现三个方法：</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> *               public void messageArrived(MqttTopic topic, MqttMessage</span></div><div class="line"><span class="comment"> *               message)接收已经预订的发布。</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> *               public void connectionLost(Throwable cause)在断开连接时调用。</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> *               public void deliveryComplete(MqttDeliveryToken token))</span></div><div class="line"><span class="comment"> *               接收到已经发布的QoS 0、 QoS 1 或 QoS 2 消息的传递令牌时调用。 由 MqttClient.connect</span></div><div class="line"><span class="comment"> *               激活此回调。</span></div><div class="line"><span class="comment"> * <span class="doctag">@author</span> zhangkai</span></div><div class="line"><span class="comment"> * <span class="doctag">@date</span> 2017年9月12日 上午11:30:44</span></div><div class="line"><span class="comment"> * </span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PushCallback</span> <span class="keyword">implements</span> <span class="title">MqttCallback</span> </span>&#123;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">connectionLost</span><span class="params">(Throwable cause)</span> </span>&#123;  </div><div class="line">        <span class="comment">// TODO 连接丢失后，一般在这里面进行重连  </span></div><div class="line">        System.out.println(<span class="string">"连接断开，可以做重连"</span>);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deliveryComplete</span><span class="params">(IMqttDeliveryToken token)</span> </span>&#123;  </div><div class="line">        System.out.println(<span class="string">"deliveryComplete---------"</span> + token.isComplete());  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">messageArrived</span><span class="params">(String topic, MqttMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;  </div><div class="line">        <span class="comment">// TODO subscribe后得到的消息会执行到这里面，后续工作将在这里进行  </span></div><div class="line">        System.out.println(<span class="string">"接收消息主题 : "</span> + topic);  </div><div class="line">        System.out.println(<span class="string">"接收消息Qos : "</span> + message.getQos());  </div><div class="line">        System.out.println(<span class="string">"接收消息内容 : "</span> + <span class="keyword">new</span> String(message.getPayload()));  </div><div class="line">    &#125; </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li>使用前缀通配符的方式加上特殊码区分各个机器的主题</li>
<li>由于需求，最后选择 0 级别的消息，只发送一次。</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;由于项目中需求，多个客户机终端不断发送位置给服务机，服务机根据消息，准确判断信息，并返回响应，回复该客户机。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;在这里我们的服务机，不但要订阅所有客户机的主题，还要根据客户机消息做出相应的响应，服务机同时充当客户机使用，客户机也推送主题消息，充当服务器。&lt;br&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="java" scheme="http://blog.wuwii.com/tags/java/"/>
    
      <category term="MQTT" scheme="http://blog.wuwii.com/tags/MQTT/"/>
    
  </entry>
  
  <entry>
    <title>Mosquitto用户名密码配置</title>
    <link href="http://blog.wuwii.com/mqtt-user.html"/>
    <id>http://blog.wuwii.com/mqtt-user.html</id>
    <published>2017-09-12T02:08:03.000Z</published>
    <updated>2017-09-12T10:23:23.129Z</updated>
    
    <content type="html"><![CDATA[<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>由于需要把<code>mqtt</code>部署到外网上面去，所以需要关闭<code>匿名登陆</code>，采取用户<code>认证模式</code>，而且还可能需要把主题加密。</p>
<a id="more"></a>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><p>配置参数在<code>/etc/mosquitto/mosquitto.conf</code>中，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">allow_anonymous 允许匿名登陆</div><div class="line">password_file 账号密码文件</div><div class="line">acl_file 访问控制列表</div></pre></td></tr></table></figure>
<p>配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@localhost mosquitto]<span class="comment"># vim mosquitto.conf           </span></div><div class="line"><span class="comment"># Place your local configuration in /etc/mosquitto/conf.d/</span></div><div class="line"></div><div class="line">pid_file /var/run/mosquitto.pid</div><div class="line"></div><div class="line">persistence <span class="literal">true</span></div><div class="line">persistence_location /var/lib/mosquitto/</div><div class="line"></div><div class="line"><span class="comment">#log_dest file /var/log/mosquitto/mosquitto.log</span></div><div class="line"></div><div class="line">include_dir /etc/mosquitto/conf.d</div><div class="line">allow_anonymous <span class="literal">false</span></div><div class="line">password_file /etc/mosquitto/pwfile</div><div class="line">acl_file /etc/mosquitto/aclfile</div><div class="line">port 8001</div></pre></td></tr></table></figure></p>
<h4 id="查看用户"><a href="#查看用户" class="headerlink" title="查看用户"></a>查看用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost mosquitto]<span class="comment"># cat pwfile                   </span></div><div class="line">agri:<span class="variable">$6</span><span class="variable">$NprvJLB</span>/CkEomWGy<span class="variable">$gNj5Mr6Wf</span>+2Xz16P6dIZYD/ladZZtyKQMJ/tdpy7WLepj5akpPB+hF8zolrNd5IacbsAxXDWX1vS5I9Pj4fnCA==</div></pre></td></tr></table></figure>
<p>添加用户<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mosquitto_passwd -c /etc/mosquitto/pwfile wuwii</div></pre></td></tr></table></figure></p>
<p>设置好密码</p>
<h4 id="添加Topic和用户的关系"><a href="#添加Topic和用户的关系" class="headerlink" title="添加Topic和用户的关系"></a>添加Topic和用户的关系</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># vim /etc/mosquitto/aclfile</span></div><div class="line"><span class="comment"># This affects access control for clients with no username.</span></div><div class="line"><span class="comment">#topic read $SYS/#</span></div><div class="line"></div><div class="line"><span class="comment"># This only affects clients with username "roger".</span></div><div class="line"><span class="comment">#user roger</span></div><div class="line"><span class="comment">#topic foo/bar</span></div><div class="line"><span class="comment">#user zhang</span></div><div class="line">user zhang</div><div class="line">topic <span class="built_in">read</span> mtopic/<span class="comment">#</span></div><div class="line"></div><div class="line">user zhang</div><div class="line">topic write mtopic/<span class="comment">#</span></div><div class="line"></div><div class="line"><span class="comment"># This affects all clients.</span></div><div class="line"><span class="comment"># pattern write $SYS/broker/connection/%c/state</span></div></pre></td></tr></table></figure>
<h4 id="重启测试"><a href="#重启测试" class="headerlink" title="重启测试"></a>重启测试</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost mosquitto]<span class="comment"># /etc/init.d/mosquitto restart</span></div><div class="line">Restarting mosquitto (via systemctl):                      [  确定  ]</div></pre></td></tr></table></figure>
<p>ps:添加用户的时候会出现<code>覆盖</code>的问题，再看。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#介绍&quot; class=&quot;headerlink&quot; title=&quot;介绍&quot;&gt;&lt;/a&gt;介绍&lt;/h3&gt;&lt;p&gt;由于需要把&lt;code&gt;mqtt&lt;/code&gt;部署到外网上面去，所以需要关闭&lt;code&gt;匿名登陆&lt;/code&gt;，采取用户&lt;code&gt;认证模式&lt;/code&gt;，而且还可能需要把主题加密。&lt;/p&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
      <category term="Mosquitto" scheme="http://blog.wuwii.com/tags/Mosquitto/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7 下安装mosquitto</title>
    <link href="http://blog.wuwii.com/install-mosquitto.html"/>
    <id>http://blog.wuwii.com/install-mosquitto.html</id>
    <published>2017-09-11T14:24:03.000Z</published>
    <updated>2017-09-12T00:37:52.167Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote>
<p><code>MQTT</code>（Message Queuing Telemetry Transport，消息队列遥测传输）是IBM开发的一个<code>即时通讯协议</code>，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和制动器（比如通过Twitter让房屋联网）的通信协议。</p>
</blockquote>
<a id="more"></a>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><blockquote>
<p><code>MQTT协议</code>是为大量计算能力有限，且工作在低带宽、不可靠的网络的远程传感器和控制设备通讯而设计的协议，它具有以下主要的几项特性：<br>1、使用发布/订阅消息模式，提供一对多的消息发布，解除应用程序耦合；<br>2、对负载内容屏蔽的消息传输；<br>3、使用 TCP/IP 提供网络连接；<br>4、有三种消息发布服务质量：<br>“至多一次”，消息发布完全依赖底层 TCP/IP   网络。会发生消息丢失或重复。这一级别可用于如下情况，环境传感器数据，丢失一次读记录无所谓，因为不久后还会有第二次发送。<br>“至少一次”，确保消息到达，但消息重复可能会发生。<br>“只有一次”，确保消息到达一次。这一级别可用于如下情况，在计费系统中，消息重复或丢失会导致不正确的结果。<br>5、小型传输，开销很小（固定长度的头部是 2 字节），协议交换最小化，以降低网络流量；<br>6、使用 Last Will 和 Testament 特性通知有关各方客户端异常中断的机制；</p>
</blockquote>
<h3 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h3><h4 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h4><p>在<code>/etc/yum.repos.d/</code>目录中新建一个<code>mosquitto.repo</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[home_oojah_mqtt]</div><div class="line"></div><div class="line">name=mqtt (CentOS_CentOS-7)</div><div class="line"></div><div class="line"><span class="built_in">type</span>=rpm-md</div><div class="line"></div><div class="line">baseurl=http://download.opensuse.org/repositories/home:/oojah:/mqtt/CentOS_CentOS-7/</div><div class="line"></div><div class="line">gpgcheck=1</div><div class="line"></div><div class="line">gpgkey=http://download.opensuse.org/repositories/home:/oojah:/mqtt/CentOS_CentOS-7//repodata/repomd.xml.key</div><div class="line"></div><div class="line">enabled=1</div></pre></td></tr></table></figure>
<p>执行 <code>yum search all mosquitto</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum search all mosquitto</span></div><div class="line">已加载插件：fastestmirror</div><div class="line">Loading mirror speeds from cached hostfile</div><div class="line"> * epel: mirrors.ustc.edu.cn</div><div class="line">============================================================================================================= 匹配：mosquitto ==============================================================================================================</div><div class="line">mosquitto-clients.x86_64 : Mosquitto <span class="built_in">command</span> line publish/subscribe clients</div><div class="line">mosquitto-debuginfo.x86_64 : Debug information <span class="keyword">for</span> package mosquitto</div><div class="line">mosquitto-devel.x86_64 : Development files <span class="keyword">for</span> mosquitto</div><div class="line">mosquitto.x86_64 : An Open Source MQTT v3.1/v3.1.1 Broker</div><div class="line">libmosquitto-devel.x86_64 : MQTT C client library development files</div><div class="line">libmosquitto1.x86_64 : MQTT C client library</div><div class="line">libmosquittopp-devel.x86_64 : MQTT C++ client library development files</div><div class="line">libmosquittopp1.x86_64 : MQTT C++ client library</div></pre></td></tr></table></figure></p>
<h4 id="安装mosquitto客户端"><a href="#安装mosquitto客户端" class="headerlink" title="安装mosquitto客户端"></a>安装mosquitto客户端</h4><p>执行 <code>yum install -y mosquitto-clients.x86_64</code>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum install -y mosquitto-clients.x86_64</span></div></pre></td></tr></table></figure>
<h4 id="安装mosquitto服务"><a href="#安装mosquitto服务" class="headerlink" title="安装mosquitto服务"></a>安装mosquitto服务</h4><p>执行命令 <code>yum install mosquitto.x86_64</code>  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install mosquitto.x86_64</span></div></pre></td></tr></table></figure>
<h4 id="修改mosquitto-conf文件"><a href="#修改mosquitto-conf文件" class="headerlink" title="修改mosquitto.conf文件"></a>修改mosquitto.conf文件</h4><p>文件在<code>/etc/mosquitto/mosquitto.conf</code><br>下面是可以选择的参数 在 <code>/etc/mosquitto/mosquitto.conf.example</code> 中 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># =================================================================</span></div><div class="line">  <span class="comment"># General configuration</span></div><div class="line">  <span class="comment"># =================================================================</span></div><div class="line">  <span class="comment"># 客户端心跳的间隔时间</span></div><div class="line">  <span class="comment">#retry_interval 20</span></div><div class="line">  <span class="comment"># 系统状态的刷新时间</span></div><div class="line">  <span class="comment">#sys_interval 10</span></div><div class="line">  <span class="comment"># 系统资源的回收时间，0表示尽快处理</span></div><div class="line">  <span class="comment">#store_clean_interval 10</span></div><div class="line">  <span class="comment"># 服务进程的PID</span></div><div class="line"> <span class="comment">#pid_file /var/run/mosquitto.pid</span></div><div class="line"> <span class="comment"># 服务进程的系统用户</span></div><div class="line"> <span class="comment">#user mosquitto</span></div><div class="line"> <span class="comment"># 客户端心跳消息的最大并发数</span></div><div class="line"> <span class="comment">#max_inflight_messages 10</span></div><div class="line"> <span class="comment"># 客户端心跳消息缓存队列</span></div><div class="line"> <span class="comment">#max_queued_messages 100</span></div><div class="line"> <span class="comment"># 用于设置客户端长连接的过期时间，默认永不过期</span></div><div class="line"> <span class="comment">#persistent_client_expiration</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># Default listener</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># 服务绑定的IP地址</span></div><div class="line"><span class="comment">#bind_address</span></div><div class="line"><span class="comment"># 服务绑定的端口号</span></div><div class="line"><span class="comment">#port 1883</span></div><div class="line"><span class="comment"># 允许的最大连接数，-1表示没有限制</span></div><div class="line"><span class="comment">#max_connections -1</span></div><div class="line"><span class="comment"># cafile：CA证书文件</span></div><div class="line"><span class="comment"># capath：CA证书目录</span></div><div class="line"><span class="comment"># certfile：PEM证书文件</span></div><div class="line"><span class="comment"># keyfile：PEM密钥文件</span></div><div class="line"><span class="comment">#cafile</span></div><div class="line"><span class="comment">#capath</span></div><div class="line"><span class="comment">#certfile</span></div><div class="line"><span class="comment">#keyfile</span></div><div class="line"><span class="comment"># 必须提供证书以保证数据安全性</span></div><div class="line"><span class="comment">#require_certificate false</span></div><div class="line"><span class="comment"># 若require_certificate值为true，use_identity_as_username也必须为true</span></div><div class="line"><span class="comment">#use_identity_as_username false</span></div><div class="line"><span class="comment"># 启用PSK（Pre-shared-key）支持</span></div><div class="line"><span class="comment">#psk_hint</span></div><div class="line"><span class="comment"># SSL/TSL加密算法，可以使用“openssl ciphers”命令获取</span></div><div class="line"><span class="comment"># as the output of that command.</span></div><div class="line"><span class="comment">#ciphers</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># Persistence</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># 消息自动保存的间隔时间</span></div><div class="line"><span class="comment">#autosave_interval 1800</span></div><div class="line"><span class="comment"># 消息自动保存功能的开关</span></div><div class="line"><span class="comment">#autosave_on_changes false</span></div><div class="line"><span class="comment"># 持久化功能的开关</span></div><div class="line">persistence <span class="literal">true</span></div><div class="line"><span class="comment"># 持久化DB文件</span></div><div class="line"><span class="comment">#persistence_file mosquitto.db</span></div><div class="line"><span class="comment"># 持久化DB文件目录</span></div><div class="line"><span class="comment">#persistence_location /var/lib/mosquitto/</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># Logging</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># 4种日志模式：stdout、stderr、syslog、topic</span></div><div class="line"><span class="comment"># none 则表示不记日志，此配置可以提升些许性能</span></div><div class="line">log_dest none</div><div class="line"><span class="comment"># 选择日志的级别（可设置多项）</span></div><div class="line"><span class="comment">#log_type error</span></div><div class="line"><span class="comment">#log_type warning</span></div><div class="line"><span class="comment">#log_type notice</span></div><div class="line"><span class="comment">#log_type information</span></div><div class="line"><span class="comment"># 是否记录客户端连接信息</span></div><div class="line"><span class="comment">#connection_messages true</span></div><div class="line"><span class="comment"># 是否记录日志时间</span></div><div class="line"><span class="comment">#log_timestamp true</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># Security</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># 客户端ID的前缀限制，可用于保证安全性</span></div><div class="line"><span class="comment">#clientid_prefixes</span></div><div class="line"><span class="comment"># 允许匿名用户</span></div><div class="line"><span class="comment">#allow_anonymous true</span></div><div class="line"><span class="comment"># 用户/密码文件，默认格式：username:password</span></div><div class="line"><span class="comment">#password_file</span></div><div class="line"><span class="comment"># PSK格式密码文件，默认格式：identity:key</span></div><div class="line"><span class="comment">#psk_file</span></div><div class="line"><span class="comment"># pattern write sensor/%u/data</span></div><div class="line"><span class="comment"># ACL权限配置，常用语法如下：</span></div><div class="line"><span class="comment"># 用户限制：user &lt;username&gt;</span></div><div class="line"><span class="comment"># 话题限制：topic [read|write] &lt;topic&gt;</span></div><div class="line"><span class="comment"># 正则限制：pattern write sensor/%u/data</span></div><div class="line"><span class="comment">#acl_file</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># Bridges</span></div><div class="line"><span class="comment"># =================================================================</span></div><div class="line"><span class="comment"># 允许服务之间使用“桥接”模式（可用于分布式部署）</span></div><div class="line"><span class="comment">#connection &lt;name&gt;</span></div><div class="line"><span class="comment">#address &lt;host&gt;[:&lt;port&gt;]</span></div><div class="line"><span class="comment">#topic &lt;topic&gt; [[[out | in | both] qos-level] local-prefix remote-prefix]</span></div><div class="line"><span class="comment"># 设置桥接的客户端ID</span></div><div class="line"><span class="comment">#clientid</span></div><div class="line">  <span class="comment"># 桥接断开时，是否清除远程服务器中的消息</span></div><div class="line">  <span class="comment">#cleansession false</span></div><div class="line">  <span class="comment"># 是否发布桥接的状态信息</span></div><div class="line">  <span class="comment">#notifications true</span></div><div class="line">  <span class="comment"># 设置桥接模式下，消息将会发布到的话题地址</span></div><div class="line">  <span class="comment"># $SYS/broker/connection/&lt;clientid&gt;/state</span></div><div class="line">  <span class="comment">#notification_topic</span></div><div class="line">  <span class="comment"># 设置桥接的keepalive数值</span></div><div class="line">  <span class="comment">#keepalive_interval 60</span></div><div class="line">  <span class="comment"># 桥接模式，目前有三种：automatic、lazy、once</span></div><div class="line">  <span class="comment">#start_type automatic</span></div><div class="line">  <span class="comment"># 桥接模式automatic的超时时间</span></div><div class="line">  <span class="comment">#restart_timeout 30</span></div><div class="line">  <span class="comment"># 桥接模式lazy的超时时间</span></div><div class="line">  <span class="comment">#idle_timeout 60</span></div><div class="line">  <span class="comment"># 桥接客户端的用户名</span></div><div class="line">  <span class="comment">#username</span></div><div class="line">  <span class="comment"># 桥接客户端的密码</span></div><div class="line">  <span class="comment">#password</span></div><div class="line">  <span class="comment"># bridge_cafile：桥接客户端的CA证书文件</span></div><div class="line">  <span class="comment"># bridge_capath：桥接客户端的CA证书目录</span></div><div class="line">  <span class="comment"># bridge_certfile：桥接客户端的PEM证书文件</span></div><div class="line">  <span class="comment"># bridge_keyfile：桥接客户端的PEM密钥文件</span></div><div class="line">  <span class="comment">#bridge_cafile</span></div><div class="line">  <span class="comment">#bridge_capath</span></div><div class="line">  <span class="comment">#bridge_certfile</span></div><div class="line">  <span class="comment">#bridge_keyfile</span></div><div class="line">  <span class="comment"># 自己的配置可以放到以下目录中</span></div><div class="line">  include_dir /etc/mosquitto/conf.d</div></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mosquitto -c /etc/mosquitto/mosquitto.conf -d</div></pre></td></tr></table></figure>
<p>主要还是根据需求来配置好用户和加密，用的时候需要了解mqtt协议。 </p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;MQTT&lt;/code&gt;（Message Queuing Telemetry Transport，消息队列遥测传输）是IBM开发的一个&lt;code&gt;即时通讯协议&lt;/code&gt;，有可能成为物联网的重要组成部分。该协议支持所有平台，几乎可以把所有联网物品和外部连接起来，被用来当做传感器和制动器（比如通过Twitter让房屋联网）的通信协议。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
      <category term="mosquitto" scheme="http://blog.wuwii.com/tags/mosquitto/"/>
    
  </entry>
  
  <entry>
    <title>心</title>
    <link href="http://blog.wuwii.com/heart00.html"/>
    <id>http://blog.wuwii.com/heart00.html</id>
    <published>2017-09-07T15:08:03.000Z</published>
    <updated>2017-09-08T08:59:15.537Z</updated>
    
    <content type="html"><![CDATA[<p>不知道现在你过得到底怎么样，看到你的签名又换了“心比长相好，懂比爱重要”。</p>
<a id="more"></a>
<p>当一个假文艺青年、一个又对你敏感的人看到这句话的时候。我想你可能经历了这段失败的感情真的伤得很深吧。</p>
<p>想照顾你的人很多吧，真的本该消失的人不该再来出现了，我也迷茫了，感觉这段时间忘的东西好快，过的没感觉，没心没肺了。</p>
<p>但是姑娘，最懂你的是自己啊，自己想什么就勇敢做吧，不要记挂在别人身上，也不用太在意别人感受，即使再大的事情还是需要自己来抗，如果听到身边的人一句安慰就溃不成军的话，那还有什么意义了。希望你能坚强，冲动和任性的事情也要少做呀！</p>
<p>但是姑娘不要自我怀疑，不要慌张，你很优秀，一定会嫁给爱情的。越是着急，就越容易受伤。除了爸妈，不必在乎催促你的人，大多数的他们的知识随口问问而已，他们只关心你结没结婚，谈没谈恋爱，真的不必放在心上。</p>
<p>希望你能努力生活，丰富自己，愿生活有诗，有梦，有远方，还有一个懂你、爱你的可心人。</p>
<p>愿大家都越变越好。</p>
]]></content>
    
    <summary type="html">
    
      不知道现在你过得到底怎么样，看到你的签名又换了“心比长相好，懂比爱重要”。
    
    </summary>
    
      <category term="碎碎念" scheme="http://blog.wuwii.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
      <category term="心情" scheme="http://blog.wuwii.com/tags/%E5%BF%83%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>Geotools做个最简单叠加分析</title>
    <link href="http://blog.wuwii.com/geotools-over-analyze.html"/>
    <id>http://blog.wuwii.com/geotools-over-analyze.html</id>
    <published>2017-09-07T09:51:03.000Z</published>
    <updated>2017-09-08T07:08:29.505Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>最近需要利用<code>Geotools</code>开发一些业务需求，今天刚开始搞。本来说是跟跟最新版的<code>geoserver</code>中的geotools一个版本，我的geoserver版本如下<br><img src="http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170907172642.png" alt="image">  <a id="more"></a><br><code>geotools</code>版本是<code>17.2</code><br>就屁颠的去项目的pom.xml配置了<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">geotools.version</span>&gt;</span>17.2<span class="tag">&lt;/<span class="name">geotools.version</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- Provides support for PostGIS. Note the different groupId --&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.geotools.jdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gt-jdbc-postgis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;geotools.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </div><div class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.geotools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gt-cql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    		<span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;geotools.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </div><div class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    	    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.geotools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gt-opengis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;geotools.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="出了点×"><a href="#出了点×" class="headerlink" title="出了点×"></a>出了点×</h3><p>结果，一直报错这几个包下不下来，我使用的是国内的阿里云镜像。刚开始我还以为是阿里云仓库没这几个包，换成了国外的节点，结果也下不了。网上去看了下最新的17.2全有，不知道为什么突然下不了。弄了好半天，坑死了有木有啊。<br>后来想到我不是做了<code>geoserver</code>的开发了吗？也是maven项目，知道geoserver使用的geotools开发的，那它的jar包是从哪里来的。<br>打开geoserver 源码一看，结果一看人家用的是 <code>18-SNAPSHOT</code><br>做事还是冒失了点，我应该去仓库看下我的版本号，最后搞得一头包。<br>好了，解决了包得问题直接干活敲代码，很简单  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.geotools.data.DataStore;</div><div class="line"><span class="keyword">import</span> org.geotools.data.DataStoreFinder;</div><div class="line"><span class="keyword">import</span> org.geotools.data.postgis.PostgisNGDataStoreFactory;</div><div class="line"><span class="keyword">import</span> org.geotools.data.simple.SimpleFeatureCollection;</div><div class="line"><span class="keyword">import</span> org.geotools.data.simple.SimpleFeatureSource;</div><div class="line"><span class="keyword">import</span> org.geotools.feature.FeatureIterator;</div><div class="line"><span class="keyword">import</span> org.geotools.filter.text.cql2.CQL;</div><div class="line"><span class="keyword">import</span> org.geotools.filter.text.cql2.CQLException;</div><div class="line"><span class="keyword">import</span> org.geotools.geometry.jts.JTSFactoryFinder;</div><div class="line"><span class="keyword">import</span> org.opengis.feature.simple.SimpleFeature;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.opengis.filter.Filter;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.vividsolutions.jts.geom.Geometry;</div><div class="line"><span class="keyword">import</span> com.vividsolutions.jts.geom.GeometryFactory;</div><div class="line"><span class="keyword">import</span> com.vividsolutions.jts.io.ParseException;</div><div class="line"><span class="keyword">import</span> com.vividsolutions.jts.io.WKTReader;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">/** </span></div><div class="line"><span class="comment">* <span class="doctag">@ClassName</span>: GeotoolsUtils </span></div><div class="line"><span class="comment">* <span class="doctag">@Description</span>:  Geotools tools solution</span></div><div class="line"><span class="comment">* <span class="doctag">@author</span> zhangkai </span></div><div class="line"><span class="comment">* <span class="doctag">@date</span> 2017年9月7日 下午3:15:53 </span></div><div class="line"><span class="comment">*  </span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeotoolsUtils</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> DataStore pgDatastore;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 连接数据库</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> dbtype  postgresql</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> host 主机</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> port 端口</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> database 数据库</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> userName </span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> password</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">conn</span><span class="params">(String dbtype, String host, String port,  </span></span></div><div class="line"><span class="function"><span class="params">            String database, String userName, String password)</span> </span>&#123;  </div><div class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">        params.put(PostgisNGDataStoreFactory.DBTYPE.key, dbtype);  </div><div class="line">        params.put(PostgisNGDataStoreFactory.HOST.key, host);  </div><div class="line">        params.put(PostgisNGDataStoreFactory.PORT.key, <span class="keyword">new</span> Integer(port));  </div><div class="line">        params.put(PostgisNGDataStoreFactory.DATABASE.key, database);  </div><div class="line">        params.put(PostgisNGDataStoreFactory.SCHEMA.key, <span class="string">"public"</span>);  </div><div class="line">        params.put(PostgisNGDataStoreFactory.USER.key, userName);  </div><div class="line">        params.put(PostgisNGDataStoreFactory.PASSWD.key, password); </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            pgDatastore = DataStoreFinder.getDataStore(params);  </div><div class="line">            <span class="keyword">if</span> (pgDatastore != <span class="keyword">null</span>) &#123;  </div><div class="line">                System.out.println(<span class="string">"系统连接到位于："</span> + host + <span class="string">"的空间数据库"</span> + database  </div><div class="line">                        + <span class="string">"成功！"</span>);  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                System.out.println(<span class="string">"系统连接到位于："</span> + host + <span class="string">"的空间数据库"</span> + database  </div><div class="line">                        + <span class="string">"失败！请检查相关参数"</span>);  </div><div class="line">            &#125;  </div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </div><div class="line">            e.printStackTrace();  </div><div class="line">            System.out.println(<span class="string">"系统连接到位于："</span> + host + <span class="string">"的空间数据库"</span> + database  </div><div class="line">                    + <span class="string">"失败！请检查相关参数"</span>);  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">    &#125;  </div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line"><span class="comment">	 * 条件查询</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> filterStr sql条件</span></div><div class="line"><span class="comment">	 * <span class="doctag">@param</span> layerName 图层名</span></div><div class="line"><span class="comment">	 * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">	 * <span class="doctag">@throws</span> IOException</span></div><div class="line"><span class="comment">	 */</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ArrayList&lt;SimpleFeature&gt; <span class="title">queryMethod</span><span class="params">(String filterStr,  </span></span></div><div class="line"><span class="function"><span class="params">            String layerName)</span> <span class="keyword">throws</span> IOException </span>&#123;  </div><div class="line">        SimpleFeatureSource featureSource =pgDatastore.getFeatureSource(layerName);   </div><div class="line">        ArrayList&lt;SimpleFeature&gt; featureList = <span class="keyword">new</span> ArrayList&lt;SimpleFeature&gt;();  </div><div class="line">        <span class="keyword">if</span>(featureSource==<span class="keyword">null</span>)  </div><div class="line">            <span class="keyword">return</span> featureList;  </div><div class="line">        <span class="keyword">try</span> &#123;  </div><div class="line">            SimpleFeatureCollection result = <span class="keyword">null</span>;</div><div class="line">        	<span class="keyword">if</span> (!StringUtils.isEmpty(filterStr)) &#123;</div><div class="line">        		 Filter filter;  </div><div class="line">                 <span class="comment">// filterStr : convert 'SQL' into 'CQL'</span></div><div class="line">                 filter = CQL.toFilter(filterStr);  </div><div class="line">                 result = featureSource.getFeatures(filter);  </div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				result = featureSource.getFeatures();</div><div class="line">			&#125;</div><div class="line">            FeatureIterator&lt;SimpleFeature&gt; itertor = result.features(); </div><div class="line">            <span class="keyword">while</span> (itertor.hasNext()) &#123;  </div><div class="line">                SimpleFeature feature = itertor.next();  </div><div class="line">                featureList.add(feature);  </div><div class="line">            &#125;  </div><div class="line">            itertor.close();  </div><div class="line">            <span class="keyword">return</span> featureList;  </div><div class="line">        &#125;  <span class="keyword">catch</span> (IOException e) &#123;  </div><div class="line">            e.printStackTrace();  </div><div class="line">        &#125; <span class="keyword">catch</span> (CQLException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </div><div class="line">    &#125; </div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 判断一个点在一个面里</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> point</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> polygon</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">containsPonit</span><span class="params">(Geometry point, Geometry polygon)</span> </span>&#123;</div><div class="line">    	<span class="keyword">return</span> polygon.contains(point);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 查询地块，判断一个点是否在面里（可能多个面）</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> filterStr 查询条件</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> layerName 图层名</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> point 点位置</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">MultitudeContainsPonit</span><span class="params">(String filterStr, String layerName, Geometry point)</span> </span>&#123;</div><div class="line">		<span class="keyword">boolean</span> result = <span class="keyword">false</span>;</div><div class="line">		List&lt;Geometry&gt; listGeometry = getGeometryByCondition(filterStr, layerName);</div><div class="line">		<span class="keyword">for</span> (Geometry geometry : listGeometry) &#123;</div><div class="line">			result = containsPonit(point, geometry);</div><div class="line">			<span class="keyword">if</span> (result) &#123;</div><div class="line">				<span class="keyword">return</span> result;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 根据条件查询该图层中的geometry</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> filterStr 查询条件</span></div><div class="line"><span class="comment">     * <span class="doctag">@param</span> layerName 图层名字</span></div><div class="line"><span class="comment">     * <span class="doctag">@return</span></span></div><div class="line"><span class="comment">     */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Geometry&gt; <span class="title">getGeometryByCondition</span><span class="params">(String filterStr, String layerName)</span> </span>&#123;</div><div class="line">    	List&lt;Geometry&gt; result = <span class="keyword">new</span> ArrayList&lt;Geometry&gt;();</div><div class="line">    	ArrayList&lt;SimpleFeature&gt; list = <span class="keyword">null</span>;</div><div class="line">    	<span class="keyword">try</span> &#123;</div><div class="line">			list = queryMethod(filterStr, layerName);</div><div class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">    	<span class="keyword">for</span> (SimpleFeature feature : list) &#123;</div><div class="line">    		Geometry geo = (Geometry) feature.getDefaultGeometry();</div><div class="line">    		result.add(geo);</div><div class="line">		&#125;</div><div class="line">    	<span class="keyword">return</span> result;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p> 简单测试下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, ParseException </span>&#123;</div><div class="line">		conn(<span class="string">"postgis"</span>, <span class="string">"192.168.19.200"</span>, <span class="string">"5432"</span>, <span class="string">"agrigisdb"</span>, <span class="string">"postgres"</span>, <span class="string">"postgres"</span>);</div><div class="line">		<span class="comment">//String wktPoly = "MultiPOLYGON (((30 10, 40 40, 20 40, 10 20, 30 10)))"; //wkt格式  </span></div><div class="line">		 String wktPoint = <span class="string">"POINT (50 50)"</span>;    </div><div class="line">		WKTReader reader = <span class="keyword">new</span> WKTReader(JTSFactoryFinder.getGeometryFactory());  </div><div class="line">		        GeometryFactory geometryFactory = JTSFactoryFinder.getGeometryFactory(<span class="keyword">null</span>);  </div><div class="line">		Geometry point = reader.read(wktPoint);  </div><div class="line">		<span class="comment">//Geometry poly = reader.read(wktPoly); </span></div><div class="line">		<span class="keyword">if</span> (MultitudeContainsPonit(<span class="string">"\"mc\"='武汉市'"</span>, <span class="string">"xzqxian"</span>, point)) &#123;</div><div class="line">			System.out.println(<span class="string">"叠加了"</span>);</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			System.out.println(<span class="string">"没叠加了"</span>);</div><div class="line">		&#125;</div><div class="line">		pgDatastore.dispose();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>还是太心急，被个小问题差点Over了，我都准备最蠢的办法，直接下包，蠢哭了，我已经下下来了，80+M。<br>记录下。加油。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;p&gt;最近需要利用&lt;code&gt;Geotools&lt;/code&gt;开发一些业务需求，今天刚开始搞。本来说是跟跟最新版的&lt;code&gt;geoserver&lt;/code&gt;中的geotools一个版本，我的geoserver版本如下&lt;br&gt;&lt;img src=&quot;http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170907172642.png&quot; alt=&quot;image&quot;&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="java" scheme="http://blog.wuwii.com/tags/java/"/>
    
      <category term="Geotools" scheme="http://blog.wuwii.com/tags/Geotools/"/>
    
  </entry>
  
  <entry>
    <title>关于难产孕妇跳楼事件</title>
    <link href="http://blog.wuwii.com/yunfu-event.html"/>
    <id>http://blog.wuwii.com/yunfu-event.html</id>
    <published>2017-09-06T14:48:03.000Z</published>
    <updated>2017-09-12T00:37:52.175Z</updated>
    
    <content type="html"><![CDATA[<p>看到新闻，难产孕妇跳楼身亡，真的很难想象，这个产妇经历了什么，才选择了这么个结果，一尸两命。</p>
<p>可能传统的文化，在大多数人眼里，顺产对孩子比较好吧。</p>
<p>整个事情我可能不是很了解，但是这是这个家庭的悲剧，也是社会的一个反射。一个女人，怀孕了都不能决定自己的命运，是在多么绝望的情况下，才跳下楼。</p>
<p>反思就不多说，每个人都清楚。</p>
<p>记录，改变就是最好的。</p>
]]></content>
    
    <summary type="html">
    
      看到新闻，难产孕妇跳楼身亡，真的很难想象，这个产妇经历了什么，才选择了这么个结果，一尸两命。
    
    </summary>
    
      <category term="生活" scheme="http://blog.wuwii.com/categories/%E7%94%9F%E6%B4%BB/"/>
    
    
      <category term="心情" scheme="http://blog.wuwii.com/tags/%E5%BF%83%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>叫魂</title>
    <link href="http://blog.wuwii.com/jiao-hun-awakening.html"/>
    <id>http://blog.wuwii.com/jiao-hun-awakening.html</id>
    <published>2017-09-05T12:08:03.000Z</published>
    <updated>2017-09-08T09:02:59.391Z</updated>
    
    <content type="html"><![CDATA[<p>最近人的心很杂乱，总是回忆起以前的种种，加上今天是<code>中元节</code>，想起了以前的一件事，正式说法应该是<code>叫魂</code>。<a id="more"></a>  </p>
<p>大约十三四岁的时候，严冬，我记得冷得厉害，我生了一场重病，高烧39度，吊针了一周都没退下去，而且人还难受得厉害了。有时候还会呻吟。老人们都见的世道多，说我有可能见鬼了，弄不好小命都可能保不住了。很无奈，母亲带我去村里的一个老奶奶家里。当时我很奇怪，把我带到一个黑漆漆的屋子里，开了灯，被吓到，就是跟看恐怖片一样，满墙都是各种奇怪的字画、条幅。很快，老奶奶一算，说是我被鬼吓的，掉了魂，是被村里的池塘里淹死的小孩下的（那个池塘就在上学的路上，确实淹死过小孩），后来问我有没有在池塘边摔倒过，这个倒是记得太清楚了。随后，她烧起纸钱，让我去烧香、磕头，最后是喝水拌下纸钱留下的灰，晚上还得去池塘边烧纸。如此，第二天病真的基本好了。不过，却给我留下别的后遗症了，有时候会想，这世间真的有鬼神吗？</p>
<p>我也不知道这些奇奇怪怪的事情应该怎么解释，但是那位老奶奶确实帮助不少人治好了疑难杂症，不乏一些从城里专门过来拜访的人。但，我只知道这个应该是祖祖辈辈传下来的，也只要那些稀奇古怪的人在这些特殊的场合才会有人使用的吧。</p>
<p>虽然事情过了很长时间，但是我也从没忘记这些事情，后来在网上查到，说这个事情是–<code>叫魂</code>。</p>
<p>还说到这些人都要<code>受耻</code>，因为他们泄露了大秘密，需要忏悔，所有对别人的好，都要降罪到自己身上。</p>
<p>多年前，那位老奶奶也去世了，听说各地来的人很多。听我妈说，信佛的人不能跟他们走太近。</p>
<p>往事如风，生活中处处充满了不一样的故事，虽然这个事情没人能够解释它，但是它却是确确实实存在的啊。</p>
]]></content>
    
    <summary type="html">
    
      最近人的心很杂乱，总是回忆起以前的种种，加上今天是``中元节``，想起了以前的一件事，正式说法应该是``叫魂``。
    
    </summary>
    
      <category term="碎碎念" scheme="http://blog.wuwii.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
      <category term="生活" scheme="http://blog.wuwii.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
      <category term="奇异" scheme="http://blog.wuwii.com/tags/%E5%A5%87%E5%BC%82/"/>
    
  </entry>
  
  <entry>
    <title>枚举的封装设计</title>
    <link href="http://blog.wuwii.com/enumeration-package-design.html"/>
    <id>http://blog.wuwii.com/enumeration-package-design.html</id>
    <published>2017-09-04T15:08:03.000Z</published>
    <updated>2017-09-06T00:31:33.314Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><code>enum</code> 的全称为 <code>enumeration</code>， 是 <code>JDK 1.5</code>  中引入的新特性，存放在 <code>java.lang</code> 包中。虽然功能少，但是实际开发中还是非常方便的。</p>
</blockquote>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MenuType &#123;</div><div class="line"><span class="comment">// 注意：枚举成员命名，请使用英文大写形式  </span></div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 目录</span></div><div class="line"><span class="comment">     */</span></div><div class="line">	CATALOG(<span class="number">0</span>),</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 菜单</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    MENU(<span class="number">1</span>),</div><div class="line">    <span class="comment">/**</span></div><div class="line"><span class="comment">     * 按钮</span></div><div class="line"><span class="comment">     */</span></div><div class="line">    BUTTON(<span class="number">2</span>);</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="comment">// 私有的构造方法</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MenuType</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">enum</span> Operation &#123;</div><div class="line">        GETCAPABILITIES &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        DESCRIBEFEATURETYPE &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        GETFEATURE&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; ,</div><div class="line">        LOCKFEATURE&#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; ,</div><div class="line">        TRANSACTION_INSERT &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">4</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        TRANSACTION_UPDATE &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">8</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        TRANSACTION_DELETE &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">16</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;, </div><div class="line">        TRANSACTION_REPLACE &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">32</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        </div><div class="line">        <span class="function"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span></span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">    	System.out.println(Operation.TRANSACTION_INSERT.getCode());</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;enum&lt;/code&gt; 的全称为 &lt;code&gt;enumeration&lt;/code&gt;， 是 &lt;code&gt;JDK 1.5&lt;/code&gt;  中引入的新特性，存放在 &lt;code&gt;java.lang&lt;/code&gt; 包中。虽然功能少，但是实际开发中还是非常方便的。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="java" scheme="http://blog.wuwii.com/tags/java/"/>
    
      <category term="枚举" scheme="http://blog.wuwii.com/tags/%E6%9E%9A%E4%B8%BE/"/>
    
  </entry>
  
  <entry>
    <title>分享：李开复：我的爱情故事</title>
    <link href="http://blog.wuwii.com/kaifu-love-story.html"/>
    <id>http://blog.wuwii.com/kaifu-love-story.html</id>
    <published>2017-09-03T14:38:03.000Z</published>
    <updated>2017-09-05T01:14:23.393Z</updated>
    
    <content type="html"><![CDATA[<blockquote>
<p><strong>最好的爱情，并不是终日互相对视，而是共同眺望远方，相伴而行。他们眺望着的，始终是同一个方向。</strong> </p>
</blockquote>
<a id="more"></a> 
<p><a href="http://weibo.com/ttarticle/p/show?id=2309404145816167164260" target="_blank" rel="external">李开复：我的爱情故事</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;最好的爱情，并不是终日互相对视，而是共同眺望远方，相伴而行。他们眺望着的，始终是同一个方向。&lt;/strong&gt; &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="分享" scheme="http://blog.wuwii.com/categories/%E5%88%86%E4%BA%AB/"/>
    
    
      <category term="李开复" scheme="http://blog.wuwii.com/tags/%E6%9D%8E%E5%BC%80%E5%A4%8D/"/>
    
      <category term="感情" scheme="http://blog.wuwii.com/tags/%E6%84%9F%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>关于npm install hexo出错</title>
    <link href="http://blog.wuwii.com/hexo_install_error.html"/>
    <id>http://blog.wuwii.com/hexo_install_error.html</id>
    <published>2017-08-31T14:43:03.000Z</published>
    <updated>2017-09-05T01:14:59.665Z</updated>
    
    <content type="html"><![CDATA[<h3 id="出现问题"><a href="#出现问题" class="headerlink" title="出现问题"></a>出现问题</h3><blockquote>
<p>最近跳槽换公司后，又要重新在公司电脑上搭个hexo blog环境，从github上拷贝下自己的源码后，执行<strong>npm install hexo</strong> 突然报错了。  </p>
</blockquote>
<a id="more"></a>  
<blockquote>
<p>node -v8.4.0x64</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">PS D:\zhangkai\WorkSpace\Git\hexo&gt; npm install hexo</div><div class="line"></div><div class="line">&gt; dtrace-provider@0.8.3 install D:\zhangkai\WorkSpace\Git\hexo\node_modules\dtrace-provider</div><div class="line">&gt; node scripts/install.js</div><div class="line"></div><div class="line">npm ERR! path D:\zhangkai\WorkSpace\Git\hexo\node_modules\fsevents\node_modules</div><div class="line">npm ERR! code EPERM</div><div class="line">npm ERR! errno -4048</div><div class="line">npm ERR! syscall scandir</div><div class="line">npm ERR! Error: EPERM: operation not permitted, scandir <span class="string">'D:\zhangkai\WorkSpace\Git\hexo\node_mod</span></div><div class="line"><span class="string">es'</span></div><div class="line">npm ERR!  &#123; Error: EPERM: operation not permitted, scandir <span class="string">'D:\zhangkai\WorkSpace\Git\hexo\node_</span></div><div class="line"><span class="string">dules'</span></div><div class="line">npm ERR!   stack: <span class="string">'Error: EPERM: operation not permitted, scandir \'</span>D:\\zhangkai\\WorkSpace\\Git</div><div class="line">events\\node_modules\<span class="string">''</span>,</div><div class="line">npm ERR!   errno: -4048,</div><div class="line">npm ERR!   code: <span class="string">'EPERM'</span>,</div><div class="line">npm ERR!   syscall: <span class="string">'scandir'</span>,</div><div class="line">npm ERR!   path: <span class="string">'D:\\zhangkai\\WorkSpace\\Git\\hexo\\node_modules\\fsevents\\node_modules'</span> &#125;</div><div class="line">npm ERR!</div><div class="line">npm ERR! Please try running this <span class="built_in">command</span> again as root/Administrator.</div><div class="line"></div><div class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>:</div><div class="line">npm ERR!     C:\Users\server\AppData\Roaming\npm-cache\_logs\2017-08-31T02_56_34_677Z-debug.log</div></pre></td></tr></table></figure>
<ul>
<li>看上面的问题就是path有问题，去电脑找这个目录找啊找，完全没有，坑爹啊。由于我目前完全不懂node.js和npm只好问候百度大爷。</li>
<li>找到问题<img src="http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170831111112.png" alt="图片"></li>
</ul>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>查看当前的npm版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS D:\zhangkai\WorkSpace\Git\hexo&gt; npm -v</div><div class="line">5.3.0</div></pre></td></tr></table></figure></p>
<p>更新到最新版，使用taobao镜像<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">PS D:\zhangkai\WorkSpace\Git\hexo&gt; npm install -g cnpm --registry=http://registry.npm.taobao.org</div><div class="line">C:\Users\server\AppData\Roaming\npm\cnpm -&gt; C:\Users\server\AppData\Roaming\npm\node_modules\cnpm\bin\cnpm</div><div class="line">+ cnpm@5.1.1</div><div class="line">added 643 packages <span class="keyword">in</span> 84.276s</div></pre></td></tr></table></figure></p>
<blockquote>
<p>如果想更新到指定版本，运行指令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm -g install npm@2.9.1</div></pre></td></tr></table></figure>
<p>重新查看npm版本号<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS D:\zhangkai\WorkSpace\Git\hexo&gt; npm -v</div><div class="line">5.3.0</div></pre></td></tr></table></figure></p>
<blockquote>
<p>ps:版本完全没变化，心凉了，还是试试吧。<br>重新执行，成功解决</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">PS D:\zhangkai\WorkSpace\Git\hexo&gt; npm install hexo</div><div class="line"></div><div class="line">&gt; dtrace-provider@0.8.5 install D:\zhangkai\WorkSpace\Git\hexo\node_modules\dtrace-provider</div><div class="line">&gt; node scripts/install.js</div><div class="line"></div><div class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.2 (node_modules\fsevents):</div><div class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="keyword">for</span> fsevents@1.1.2: wanted &#123;<span class="string">"os"</span>:<span class="string">"darwin"</span>,<span class="string">"arch"</span>:<span class="string">"any</span></div><div class="line"><span class="string">"</span>&#125; (current: &#123;<span class="string">"os"</span>:<span class="string">"win32"</span>,<span class="string">"arch"</span>:<span class="string">"x64"</span>&#125;)</div><div class="line"></div><div class="line">+ hexo@3.3.8</div><div class="line">added 122 packages and updated 9 packages <span class="keyword">in</span> 40.962s</div></pre></td></tr></table></figure>
<blockquote>
<p>ps:虽然版本号没变，但是起码解决了问题，ok，又可以愉快玩耍了（警告什么的都不是事）。</p>
</blockquote>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;出现问题&quot;&gt;&lt;a href=&quot;#出现问题&quot; class=&quot;headerlink&quot; title=&quot;出现问题&quot;&gt;&lt;/a&gt;出现问题&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;最近跳槽换公司后，又要重新在公司电脑上搭个hexo blog环境，从github上拷贝下自己的源码后，执行&lt;strong&gt;npm install hexo&lt;/strong&gt; 突然报错了。  &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="hexo" scheme="http://blog.wuwii.com/tags/hexo/"/>
    
      <category term="npm" scheme="http://blog.wuwii.com/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>Linux下如何修改用户默认目录</title>
    <link href="http://blog.wuwii.com/linux_user_default_path.html"/>
    <id>http://blog.wuwii.com/linux_user_default_path.html</id>
    <published>2017-08-31T14:16:03.000Z</published>
    <updated>2017-09-05T01:15:59.057Z</updated>
    
    <content type="html"><![CDATA[<h3 id="提出问题"><a href="#提出问题" class="headerlink" title="提出问题"></a>提出问题</h3><blockquote>
<p>在<code>ftp</code>服务器中，ftp登陆的用户只能在自己的文件夹下活动，现在我需要改这个用户的所属文件位置。 </p>
</blockquote>
<a id="more"></a>  
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><ul>
<li><p>使用root用户，执行命令</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># cat /etc/passwd</span></div><div class="line">root:x:0:0:root:/root:/bin/bash</div><div class="line">bin:x:1:1:bin:/bin:/sbin/nologin</div><div class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</div><div class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</div><div class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</div><div class="line">sync:x:5:0:sync:/sbin:/bin/sync</div><div class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</div><div class="line">halt:x:7:0:halt:/sbin:/sbin/halt</div><div class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</div><div class="line">operator:x:11:0:operator:/root:/sbin/nologin</div><div class="line">games:x:12:100:games:/usr/games:/sbin/nologin</div><div class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</div><div class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</div><div class="line">systemd-bus-proxy:x:999:997:systemd Bus Proxy:/:/sbin/nologin</div><div class="line">systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin</div><div class="line">dbus:x:81:81:System message bus:/:/sbin/nologin</div><div class="line">polkitd:x:998:996:User <span class="keyword">for</span> polkitd:/:/sbin/nologin</div><div class="line">tss:x:59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin</div><div class="line">postfix:x:89:89::/var/spool/postfix:/sbin/nologin</div><div class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</div><div class="line">kaim:x:1000:1000:kaim:/home/kaim:/bin/bash</div><div class="line">user1:x:1001:1001::/home/user1:/bin/bash</div><div class="line">rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin</div><div class="line">rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin</div><div class="line">nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin</div><div class="line">test2:x:1002:50::/opt/test_ftp:/sbin/nologin</div><div class="line">test1:x:1003:50::/opt/test_ftp:/sbin/nologin</div><div class="line">test3:x:1004:50::/opt/test_ftp:/sbin/nologin</div><div class="line">test4:x:1005:50::/opt/test_ftp:/sbin/nologin</div><div class="line">test5:x:1006:50::/opt/test5_ftp:/sbin/nologin</div></pre></td></tr></table></figure>
</li>
<li><p>直接修改目录名保存就可以，记得分配权限。</p>
</li>
</ul>
<hr>
<h3 id="附：添加，修改用户参数"><a href="#附：添加，修改用户参数" class="headerlink" title="附：添加，修改用户参数"></a>附：添加，修改用户参数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/adduser -d /opt/test_ftp -g ftp -s /sbin/nologin test2</div><div class="line">上面的命令是添加一个 名称为 test2的用户。</div><div class="line"></div><div class="line">命令解析：使用命令(adduser)添加test2用户,不能登录系统(-s /sbin/nologin),自己的文件夹在(-d /opt/test_ftp)),属于组ftp(-g ftp).</div><div class="line"></div><div class="line">usermod -s /sbin/nologin <span class="built_in">test</span> //限定用户<span class="built_in">test</span>不能telnet</div><div class="line">usermod -s /sbin/bash <span class="built_in">test</span> //用户<span class="built_in">test</span>恢复正常</div><div class="line">usermod -d /<span class="built_in">test</span> <span class="built_in">test</span> //更改用户<span class="built_in">test</span>的主目录为/<span class="built_in">test</span></div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;提出问题&quot;&gt;&lt;a href=&quot;#提出问题&quot; class=&quot;headerlink&quot; title=&quot;提出问题&quot;&gt;&lt;/a&gt;提出问题&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;在&lt;code&gt;ftp&lt;/code&gt;服务器中，ftp登陆的用户只能在自己的文件夹下活动，现在我需要改这个用户的所属文件位置。 &lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linux上搭建ftp服务器</title>
    <link href="http://blog.wuwii.com/vsftpd.html"/>
    <id>http://blog.wuwii.com/vsftpd.html</id>
    <published>2017-08-30T14:08:03.000Z</published>
    <updated>2017-09-12T00:37:52.172Z</updated>
    
    <content type="html"><![CDATA[<h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><blockquote>
<p><code>vsftpd</code> 是“very secure FTP daemon”的缩写，安全性是它的一个最大的特点。vsftpd 是一个 UNIX 类操作系统上运行的服务器的名字，它可以运行在诸如 Linux、BSD、Solaris、 HP-UNIX等系统上面，是一个完全免费的、开放源代码的ftp服务器软件，支持很多其他的 FTP 服务器所不支持的特征。比如：非常高的安全性需求、带宽限制、良好的可伸缩性、可创建虚拟用户、支持IPv6、速率高等。</p>
<p><code>vsftpd</code>是一款在<code>Linux</code>发行版中最受推崇的<code>FTP</code>服务器程序。特点是小巧轻快，安全易用。（来自百度百科）</p>
</blockquote>
<a id="more"></a>  
<h3 id="安装vsftpd"><a href="#安装vsftpd" class="headerlink" title="安装vsftpd"></a>安装vsftpd</h3><h4 id="检测是否已经安装vsftpd。"><a href="#检测是否已经安装vsftpd。" class="headerlink" title="检测是否已经安装vsftpd。"></a>检测是否已经安装vsftpd。</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># rpm -qa | grep vsftpd</span></div><div class="line">[root@localhost ~]<span class="comment">#</span></div></pre></td></tr></table></figure>
<p>什么都不显示就没有安装</p>
<h4 id="安装vsftpd-1"><a href="#安装vsftpd-1" class="headerlink" title="安装vsftpd"></a>安装vsftpd</h4><h5 id="使用yum安装"><a href="#使用yum安装" class="headerlink" title="使用yum安装"></a>使用yum安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># yum -y install vsftpd</span></div></pre></td></tr></table></figure>
<h5 id="使用rpm安装"><a href="#使用rpm安装" class="headerlink" title="使用rpm安装"></a>使用rpm安装</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># rpm -ivh vsftpd-3.0.2-21.el7.x86_64.rpm</span></div></pre></td></tr></table></figure>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># service vsftpd start</span></div><div class="line">Redirecting to /bin/systemctl start  vsftpd.service</div></pre></td></tr></table></figure>
<h4 id="查看服务状态"><a href="#查看服务状态" class="headerlink" title="查看服务状态"></a>查看服务状态</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># service vsftpd status</span></div><div class="line">Redirecting to /bin/systemctl status  vsftpd.service</div><div class="line">● vsftpd.service - Vsftpd ftp daemon</div><div class="line">   Loaded: loaded (/usr/lib/systemd/system/vsftpd.service; disabled; vendor preset: disabled)</div><div class="line">   Active: active (running) since 三 2017-08-30 15:28:18 CST; 15min ago</div><div class="line">  Process: 4295 ExecStart=/usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf (code=exited, status=0/SUCCESS)</div><div class="line"> Main PID: 4296 (vsftpd)</div><div class="line">   CGroup: /system.slice/vsftpd.service</div><div class="line">           └─4296 /usr/sbin/vsftpd /etc/vsftpd/vsftpd.conf</div><div class="line"></div><div class="line">8月 30 15:28:18 localhost.localdomain systemd[1]: Starting Vsftpd ftp daemon...</div><div class="line">8月 30 15:28:18 localhost.localdomain systemd[1]: Started Vsftpd ftp daemon.</div><div class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</div></pre></td></tr></table></figure>
<p> Active: active (running)  启动状态，可以使用</p>
<h4 id="现在我们就可以匿名访问了"><a href="#现在我们就可以匿名访问了" class="headerlink" title="现在我们就可以匿名访问了"></a>现在我们就可以匿名访问了</h4><h3 id="vsftpd添加用户"><a href="#vsftpd添加用户" class="headerlink" title="vsftpd添加用户"></a>vsftpd添加用户</h3><h4 id="vsftpd添加用户-1"><a href="#vsftpd添加用户-1" class="headerlink" title="vsftpd添加用户"></a>vsftpd添加用户</h4><p>FTP用户一般是不能登录系统的,只能进入FTP服务器自己的目录中,这是为了安全.这样的用户就叫做虚拟用户了.实际上并不是真正的虚拟用户,只是不能登录SHELL了而已,没能力登录系统.</p>
<p>添加用户命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/usr/sbin/adduser -d /opt/test_ftp -g ftp -s /sbin/nologin test2</div></pre></td></tr></table></figure></p>
<p>上面的命令是添加一个 名称为 test2的用户。</p>
<p>命令解析：使用命令(adduser)添加test2用户,不能登录系统(-s /sbin/nologin),自己的文件夹在(-d /opt/test_ftp)),属于组ftp(-g ftp).</p>
<p>为该用户设置密码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># passwd test2</span></div></pre></td></tr></table></figure></p>
<p>现在重启服务我们就可以使用test2直接访问我们的 /opttest_ftp目录了<br><img src="http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170830155115.png" alt="ftp1"></p>
<h4 id="给用户权限上传下载，修改"><a href="#给用户权限上传下载，修改" class="headerlink" title="给用户权限上传下载，修改"></a>给用户权限上传下载，修改</h4><p>虽然用户能够进行查看，但是还没有权限上传、下载和修改</p>
<h4 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost <span class="built_in">local</span>]<span class="comment"># chmod 755 /opt/test_ftp</span></div></pre></td></tr></table></figure>
<h4 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h4><p>一般创建一个ftp 用户，作为管理员只希望它只能访问其自己的所属目录的，是不会让他选择其他目录的。</p>
<p>####设置ftp用户的权限</p>
<p>在安装好ftp时，在 /etc/vsftpd目录下可以看到vsftpd的配置文件vsftpd.conf<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div></pre></td><td class="code"><pre><div class="line">[root@localhost vsftpd]<span class="comment"># vim vsftpd.conf       </span></div><div class="line"><span class="comment"># Example config file /etc/vsftpd/vsftpd.conf</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># The default compiled in settings are fairly paranoid. This sample file</span></div><div class="line"><span class="comment"># loosens things up a bit, to make the ftp daemon more usable.</span></div><div class="line"><span class="comment"># Please see vsftpd.conf.5 for all compiled in defaults.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span></div><div class="line"><span class="comment"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd's</span></div><div class="line"><span class="comment"># capabilities.</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Allow anonymous FTP? (Beware - allowed by default if you comment this out).</span></div><div class="line">anonymous_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Uncomment this to allow local users to log in.</span></div><div class="line"><span class="comment"># When SELinux is enforcing check for SE bool ftp_home_dir</span></div><div class="line">local_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Uncomment this to enable any form of FTP write command.</span></div><div class="line">write_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Default umask for local users is 077. You may wish to change this to 022,</span></div><div class="line"><span class="comment"># if your users expect that (022 is used by most other ftpd's)</span></div><div class="line">local_umask=022</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Uncomment this to allow the anonymous FTP user to upload files. This only</span></div><div class="line"><span class="comment"># has an effect if the above global write enable is activated. Also, you will</span></div><div class="line"><span class="comment"># obviously need to create a directory writable by the FTP user.</span></div><div class="line"><span class="comment"># When SELinux is enforcing check for SE bool allow_ftpd_anon_write, allow_ftpd_full_access</span></div><div class="line">anon_upload_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Uncomment this if you want the anonymous FTP user to be able to create</span></div><div class="line"><span class="comment"># new directories.</span></div><div class="line">anon_mkdir_write_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Activate directory messages - messages given to remote users when they</span></div><div class="line"><span class="comment"># go into a certain directory.</span></div><div class="line">dirmessage_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Activate logging of uploads/downloads.</span></div><div class="line">xferlog_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span></div><div class="line">connect_from_port_20=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you want, you can arrange for uploaded anonymous files to be owned by</span></div><div class="line"><span class="comment"># a different user. Note! Using "root" for uploaded files is not</span></div><div class="line"><span class="comment"># recommended!</span></div><div class="line"><span class="comment">#chown_uploads=YES</span></div><div class="line"><span class="comment">#chown_username=whoever</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may override where the log file goes if you like. The default is shown</span></div><div class="line"><span class="comment"># below.</span></div><div class="line"><span class="comment">#xferlog_file=/var/log/xferlog</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># If you want, you can have your log file in standard ftpd xferlog format.</span></div><div class="line"><span class="comment"># Note that the default log file location is /var/log/xferlog in this case.</span></div><div class="line">xferlog_std_format=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may change the default value for timing out an idle session.</span></div><div class="line">idle_session_timeout=600</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may change the default value for timing out a data connection.</span></div><div class="line">data_connection_timeout=120</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># It is recommended that you define on your system a unique user which the</span></div><div class="line"><span class="comment"># ftp server can use as a totally isolated and unprivileged user.</span></div><div class="line"><span class="comment">#nopriv_user=ftpsecure</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># Enable this and the server will recognise asynchronous ABOR requests. Not</span></div><div class="line"><span class="comment"># recommended for security (the code is non-trivial). Not enabling it,</span></div><div class="line"><span class="comment"># however, may confuse older FTP clients.</span></div><div class="line"><span class="comment">#async_abor_enable=YES</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># By default the server will pretend to allow ASCII mode but in fact ignore</span></div><div class="line"><span class="comment"># the request. Turn on the below options to have the server actually do ASCII</span></div><div class="line"><span class="comment"># mangling on files when in ASCII mode.</span></div><div class="line"><span class="comment"># Beware that on some FTP servers, ASCII support allows a denial of service</span></div><div class="line"><span class="comment"># attack (DoS) via the command "SIZE /big/file" in ASCII mode. vsftpd</span></div><div class="line"><span class="comment"># predicted this attack and has always been safe, reporting the size of the</span></div><div class="line"><span class="comment"># raw file.</span></div><div class="line"><span class="comment"># ASCII mangling is a horrible feature of the protocol.</span></div><div class="line">ascii_upload_enable=YES</div><div class="line">ascii_download_enable=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may fully customise the login banner string:</span></div><div class="line">ftpd_banner=Welcome to blah FTP service.</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span></div><div class="line"><span class="comment"># useful for combatting certain DoS attacks.</span></div><div class="line"><span class="comment">#deny_email_enable=YES</span></div><div class="line"><span class="comment"># (default follows)</span></div><div class="line"><span class="comment">#banned_email_file=/etc/vsftpd/banned_emails</span></div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may specify an explicit list of local users to chroot() to their home</span></div><div class="line"><span class="comment"># directory. If chroot_local_user is YES, then this list becomes a list of</span></div><div class="line"><span class="comment"># users to NOT chroot().</span></div><div class="line"><span class="comment"># (Warning! chroot'ing can be very dangerous. If using chroot, make sure that</span></div><div class="line"><span class="comment"># the user does not have write access to the top level directory within the</span></div><div class="line"><span class="comment"># chroot)</span></div><div class="line">chroot_local_user=YES</div><div class="line">chroot_list_enable=YES</div><div class="line"><span class="comment"># (default follows)</span></div><div class="line">chroot_list_file=/etc/vsftpd/chroot_list</div><div class="line"><span class="comment"># vsftpd：500 OOPS: vsftpd: refusing to run with writable root inside chroot ()错误的解决方法</span></div><div class="line">allow_writeable_chroot=YES </div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># You may activate the "-R" option to the builtin ls. This is disabled by</span></div><div class="line"><span class="comment"># default to avoid remote users being able to cause excessive I/O on large</span></div><div class="line"><span class="comment"># sites. However, some broken FTP clients such as "ncftp" and "mirror" assume</span></div><div class="line"><span class="comment"># the presence of the "-R" option, so there is a strong case for enabling it.</span></div><div class="line"><span class="comment">#ls_recurse_enable=YES</span></div><div class="line"><span class="comment">#</span></div><div class="line">  When <span class="string">"listen"</span> directive is enabled, vsftpd runs <span class="keyword">in</span> standalone mode and</div><div class="line">▽ listens on IPv4 sockets. This directive cannot be used <span class="keyword">in</span> conjunction</div><div class="line"><span class="comment"># with the listen_ipv6 directive.</span></div><div class="line">listen=YES</div><div class="line"><span class="comment">#</span></div><div class="line"><span class="comment"># This directive enables listening on IPv6 sockets. By default, listening</span></div><div class="line"><span class="comment"># on the IPv6 "any" address (::) will accept connections from both IPv6</span></div><div class="line"><span class="comment"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span></div><div class="line"><span class="comment"># sockets. If you want that (perhaps because you want to listen on specific</span></div><div class="line"><span class="comment"># addresses) then you must run two copies of vsftpd with two configuration</span></div><div class="line"><span class="comment"># files.</span></div><div class="line"><span class="comment"># Make sure, that one of the listen options is commented !!</span></div><div class="line"><span class="comment"># listen_ipv6=YES</span></div><div class="line"></div><div class="line">pam_service_name=vsftpd</div><div class="line">userlist_enable=YES</div><div class="line">tcp_wrappers=YES</div><div class="line">anon_other_write_enable=YES</div><div class="line"><span class="comment">#anon_root=/opt/test_ftp</span></div><div class="line"><span class="comment">#guest_enable=YES</span></div><div class="line"><span class="comment">#guest_username=test2</span></div><div class="line">virtual_use_local_privs=YES</div></pre></td></tr></table></figure></p>
<h4 id="用户访问权限及路径限制："><a href="#用户访问权限及路径限制：" class="headerlink" title="用户访问权限及路径限制："></a>用户访问权限及路径限制：</h4><p> 如果 userlist_deny=NO：只允许<code>userlist_file</code>文件中的用户可访问ftp；如果 <code>userlist_deny=YES</code>：<code>userlist_file</code>文件中列举的用户不能通过ftp访问系统。<code>userlist_enable</code>是该功能的开关。我们的系统配置如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">userlist_enable=YES</div><div class="line">userlist_deny=NO</div><div class="line">userlist_file=/etc/vsftpd/user_list</div></pre></td></tr></table></figure></p>
<p>把需要登录的用户加入到<code>/etc/vsftpd/user_list</code>文件中，一个用户一行。<br>如果我们不需要把登陆的用户限制在主目录下需要一下配置：<br>进入主配置文件中<code>chroot_list_enable=YES</code><br>创建用户文件<code>/etc/vsftpd/chroot_list</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/vsftpd/chroot_list</div></pre></td></tr></table></figure></p>
<p>将不需要限制的用户添加进去，我们只有一个test2，一行一个用户名<br>ps: 这些用户将能访问全部有权限的文件。</p>
<h4 id="设置权限"><a href="#设置权限" class="headerlink" title="设置权限"></a>设置权限</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[root@localhost vsftpd]<span class="comment"># getsebool -a|grep ftp</span></div><div class="line">ftpd_anon_write --&gt; off</div><div class="line">ftpd_connect_all_unreserved --&gt; off</div><div class="line">  pd_connect_db --&gt; off</div><div class="line">▽tpd_full_access --&gt; off</div><div class="line">ftpd_use_cifs --&gt; off</div><div class="line">ftpd_use_fusefs --&gt; off</div><div class="line">ftpd_use_nfs --&gt; off</div><div class="line">ftpd_use_passive_mode --&gt; off</div><div class="line">httpd_can_connect_ftp --&gt; off</div><div class="line">httpd_enable_ftp_server --&gt; off</div><div class="line">tftp_anon_write --&gt; off</div><div class="line">tftp_home_dir --&gt; off</div></pre></td></tr></table></figure>
<h5 id="开启-anon-write-和full-access"><a href="#开启-anon-write-和full-access" class="headerlink" title="开启 anon_write 和full_access"></a>开启 anon_write 和full_access</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost vsftpd]<span class="comment"># setsebool allow_ftpd_anon_write  1</span></div><div class="line">[root@localhost vsftpd]<span class="comment"># setsebool allow_ftpd_full_access 1</span></div></pre></td></tr></table></figure>
<h4 id="重启ftp服务"><a href="#重启ftp服务" class="headerlink" title="重启ftp服务"></a>重启ftp服务</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@localhost vsftpd]<span class="comment"># service vsftpd restart</span></div></pre></td></tr></table></figure>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><img src="http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170830160616.png" alt="ftp2"></p>
<p>注：测试连接软件是<code>FileZilla</code>，windows访问 ftp://[ip]</p>
<h3 id="update-20170901-使用FileZilla创建中文文件夹Linux乱码"><a href="#update-20170901-使用FileZilla创建中文文件夹Linux乱码" class="headerlink" title="update 20170901 使用FileZilla创建中文文件夹Linux乱码"></a>update 20170901 使用FileZilla创建中文文件夹Linux乱码</h3><p>首先出现这个问题的原因是WINDOWS采用的是<code>GBK</code>编码方式，而Linux采用的是<code>UTF-8</code><br>首先设置好FileZilla的编码方式为<code>zh_CN</code><br>在将 <code>/etc/locale.conf</code> 中的<code>LANG</code>修改为<code>&quot;zh_CN.UTF-8&quot;</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># vim /etc/locale.conf </span></div><div class="line">LANG=<span class="string">"zh_CN.UTF-8"</span></div></pre></td></tr></table></figure></p>
<p>这个修改可以有效解决windows客户端使用ftp协议上传中文文件到Linux乱码的问题。<br><strong>其实最根本的解决方法是客户端上传的文件经过ftp软件能与服务器统一编码方式</strong>，具体百度吧c#、java的都有。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;摘要&quot;&gt;&lt;a href=&quot;#摘要&quot; class=&quot;headerlink&quot; title=&quot;摘要&quot;&gt;&lt;/a&gt;摘要&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;vsftpd&lt;/code&gt; 是“very secure FTP daemon”的缩写，安全性是它的一个最大的特点。vsftpd 是一个 UNIX 类操作系统上运行的服务器的名字，它可以运行在诸如 Linux、BSD、Solaris、 HP-UNIX等系统上面，是一个完全免费的、开放源代码的ftp服务器软件，支持很多其他的 FTP 服务器所不支持的特征。比如：非常高的安全性需求、带宽限制、良好的可伸缩性、可创建虚拟用户、支持IPv6、速率高等。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;vsftpd&lt;/code&gt;是一款在&lt;code&gt;Linux&lt;/code&gt;发行版中最受推崇的&lt;code&gt;FTP&lt;/code&gt;服务器程序。特点是小巧轻快，安全易用。（来自百度百科）&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
      <category term="ftp" scheme="http://blog.wuwii.com/tags/ftp/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 7 静态IP设置</title>
    <link href="http://blog.wuwii.com/setting_static_ip.html"/>
    <id>http://blog.wuwii.com/setting_static_ip.html</id>
    <published>2017-08-29T11:35:03.000Z</published>
    <updated>2017-09-05T03:58:04.042Z</updated>
    
    <content type="html"><![CDATA[<p><strong>最近使用<code>linux</code>做服务器共享，需要设置<code>静态IP</code>，整理了一下。</strong>  <a id="more"></a>  </p>
<h3 id="获取网卡信息"><a href="#获取网卡信息" class="headerlink" title="获取网卡信息"></a>获取网卡信息</h3><h4 id="在root用户下，输入命令ifconfig"><a href="#在root用户下，输入命令ifconfig" class="headerlink" title="在root用户下，输入命令ifconfig"></a>在root用户下，输入命令ifconfig</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># ifconfig</span></div><div class="line">ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</div><div class="line">        inet 192.168.19.128  netmask 255.255.255.0  broadcast 192.168.19.255</div><div class="line">        inet6 fe80::2938:ef28:162e:9ffd  prefixlen 64  scopeid 0x20&lt;link&gt;</div><div class="line">        ether 00:0c:29:93:06:e9  txqueuelen 1000  (Ethernet)</div><div class="line">        RX packets 77  bytes 7911 (7.7 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 67  bytes 11943 (11.6 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div><div class="line"></div><div class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</div><div class="line">        inet 127.0.0.1  netmask 255.0.0.0</div><div class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</div><div class="line">        loop  txqueuelen 1  (Local Loopback)</div><div class="line">        RX packets 127  bytes 9199 (8.9 KiB)</div><div class="line">        RX errors 0  dropped 0  overruns 0  frame 0</div><div class="line">        TX packets 127  bytes 9199 (8.9 KiB)</div><div class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</div></pre></td></tr></table></figure>
<h3 id="更改配置信息"><a href="#更改配置信息" class="headerlink" title="更改配置信息"></a>更改配置信息</h3><h4 id="从上面可以看到我的网卡号是ens33"><a href="#从上面可以看到我的网卡号是ens33" class="headerlink" title="从上面可以看到我的网卡号是ens33"></a>从上面可以看到我的网卡号是ens33</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-ens33 </span></div><div class="line">TYPE=<span class="string">"Ethernet"</span></div><div class="line">BOOTPROTO=<span class="string">"static"</span></div><div class="line">IPADDR=192.168.19.128</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=192.168.19.1</div><div class="line">DEFROUTE=<span class="string">"yes"</span></div><div class="line">PEERDNS=<span class="string">"yes"</span></div><div class="line">PEERROUTES=<span class="string">"yes"</span></div><div class="line">IPV4_FAILURE_FATAL=<span class="string">"no"</span></div><div class="line">IPV6INIT=<span class="string">"yes"</span></div><div class="line">IPV6_AUTOCONF=<span class="string">"yes"</span></div><div class="line">IPV6_DEFROUTE=<span class="string">"yes"</span></div><div class="line">IPV6_PEERDNS=<span class="string">"yes"</span></div><div class="line">IPV6_PEERROUTES=<span class="string">"yes"</span></div><div class="line">IPV6_FAILURE_FATAL=<span class="string">"no"</span></div><div class="line">IPV6_ADDR_GEN_MODE=<span class="string">"stable-privacy"</span></div><div class="line">NAME=<span class="string">"ens33"</span></div><div class="line">UUID=<span class="string">"f9e34fd2-c12f-4d4c-ad93-37d0b9cc43ce"</span></div><div class="line">DEVICE=<span class="string">"ens33"</span></div><div class="line">ONBOOT=<span class="string">"yes"</span></div></pre></td></tr></table></figure>
<ul>
<li><code>BOOTPROTO</code>代表的是获取ip方式（“dhcp”＝动态获取／“static”＝设置静态ip）</li>
<li><code>IPADDR</code>代表静态ip地址 （地址就用之前ifconfig获取的inet 192.168.19.128）</li>
<li><code>NETMASK</code>代表子网掩码（地址就用之前ifconfig获取的netmask 255.255.255.0）</li>
<li><code>GATEWAY</code>代表网关（由于你的ip是192.168.58网段的，所以使用192.168.19.1，注意：你是ip地址前三位是什么网段就在后面加个1就行了）</li>
<li><code>DNS1</code>就是dns了（需要你知道你的网络的dns，一般在路由器管理后台有配置，可以不设置dns）<h3 id="最后重启下网络服务"><a href="#最后重启下网络服务" class="headerlink" title="最后重启下网络服务"></a>最后重启下网络服务</h3>注意，fail是有问题的配置<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># service network restart  </span></div><div class="line">Restarting network (via systemctl):                        [  OK  ]</div></pre></td></tr></table></figure></li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;最近使用&lt;code&gt;linux&lt;/code&gt;做服务器共享，需要设置&lt;code&gt;静态IP&lt;/code&gt;，整理了一下。&lt;/strong&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>SAMBA共享</title>
    <link href="http://blog.wuwii.com/samba.html"/>
    <id>http://blog.wuwii.com/samba.html</id>
    <published>2017-08-28T14:49:03.000Z</published>
    <updated>2017-09-05T09:10:07.998Z</updated>
    
    <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><blockquote>
<p><code>Samba</code>是在<code>Linux</code>和<code>UNIX</code>系统上实现<code>SMB协议</code>的一个免费软件，由服务器及客户端程序构成。<code>SMB</code>（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。</p>
</blockquote>
<a id="more"></a>
<p>SMB协议是客户机/服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。通过设置<code>NetBIOS over TCP/IP</code>使得Samba不但能与局域网络主机分享资源，还能与全世界的电脑分享资源。  </p>
<h3 id="安装samba"><a href="#安装samba" class="headerlink" title="安装samba"></a>安装samba</h3><ul>
<li>可以先检查下是否已经安装：<code>rpm -qa | grep samba</code><br>这里使用yum安装，可以不用担心一些依赖包的问题：<code>yum install samba</code>  </li>
<li>创建共享文件夹，这里就是<code>mkdir -m 777 /home/user1/share</code>  </li>
<li>修改<code>/etc/samba/smb.conf</code>，这里面的参数就比较多，主要是<br><code>workgroup = WORKGROUP</code>（这个就是windows工作组模式，还有一种是域模式，可以不改使用<code>MYGROUP</code>）<br><code>hosts allow = 192.168.19.207</code>（可以放问的IP地址，这里写的时windows地址，一般不填写）<br>然后在文件的结尾加上<br>[public]（共享名，就是windows访问时会显示的名称）<br>comment = Public Stuff（注释）<br>path = /home/user1/share（共享名）<br>public = yes（公开）<br>writable = yes（可写）<br>当然这里只是些基础的参数，还有其他的参数根据情况设置，比如会出现乱码，还要指定编码格式。  </li>
<li>重启smb服务：<code>service smb restart</code>、   <code>service smb status</code>  查看状态  </li>
<li>创建samba客户：<code>smbpasswd -a   user1</code>,回车后会提示输入密码。这个就是将来远程主机登录时需要的密码，这里的<code>user1</code>帐号必须是系统已经有的<br>帐号，没有的话会报错，然后新输的密码就是远程登录密码，这样做的好处就是自己的密码和远程登录的密码分开。  </li>
<li>windows下连接，启动运行，输入<code>\\192.168.19.185</code>,输入smb帐号密码就可以了  </li>
</ul>
<p>由于暂时还不会防火墙和SELINUX配置，而下面有些方法中的操作会受到他们的限制，因此先关闭这俩。<br>关闭防火墙的命令：<code>service iptables stop</code><br>关闭SELINUX命令：<code>setenforce 0</code>  </p>
<p>window下关闭网络共享连接  cmd &gt;&gt;<br><code>net use * /del /y</code></p>
<p>如果访问的是当前用户下的文件，不需要配置</p>
<p>如果访问的不是当前用户下的文件或者文件夹，需要配置<code>/etc/samba/smb.conf</code>，加入：  [Share] 为在共享中显示的文件夹名<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[Share]</div><div class="line"></div><div class="line">comment = Shared Folder with username and password</div><div class="line"></div><div class="line">path = /data</div><div class="line"></div><div class="line">public = yes</div><div class="line"></div><div class="line">writable = yes</div><div class="line"></div><div class="line">valid users = user1</div><div class="line"></div><div class="line">available = yes</div><div class="line"></div><div class="line">browseable = yes</div></pre></td></tr></table></figure></p>
<p>启动 samba 服务<br><code>systemctl start smb.service</code>  </p>
<h3 id="测试服务"><a href="#测试服务" class="headerlink" title="测试服务"></a>测试服务</h3><p>我使用的是windows客户端连接，输入Ip <code>\\192.168.19.185</code><br>我使用的是user1账户</p>
<p><img src="http://ov62kaxkk.bkt.clouddn.com/TIM%E6%88%AA%E5%9B%BE20170905093409.png" alt="samba"></p>
<p><strong>账户有权限可以正常进入到文件中</strong>  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Samba&lt;/code&gt;是在&lt;code&gt;Linux&lt;/code&gt;和&lt;code&gt;UNIX&lt;/code&gt;系统上实现&lt;code&gt;SMB协议&lt;/code&gt;的一个免费软件，由服务器及客户端程序构成。&lt;code&gt;SMB&lt;/code&gt;（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同计算机之间提供文件及打印机等资源的共享服务。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>Java中位运算符</title>
    <link href="http://blog.wuwii.com/JAVA_Bitwise_Operators.html"/>
    <id>http://blog.wuwii.com/JAVA_Bitwise_Operators.html</id>
    <published>2017-08-07T14:21:36.000Z</published>
    <updated>2017-09-05T08:48:39.282Z</updated>
    
    <content type="html"><![CDATA[<p>1、 今天在读<code>ConcurrentHashMap</code>的源码中突然发现一段很好玩的代码，大概理解它的意思。不多说上代码：<a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Returns a power of two table size for the given desired capacity.</span></div><div class="line"><span class="comment"> * See Hackers Delight, sec 3.2</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> n = c - <span class="number">1</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</div><div class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</div><div class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> <em>在 ConcurrentHashMap 源码的第688~700  line</em></p>
<ol>
<li>疑问<ol>
<li>见过<code>&gt;&gt;</code>、<code>&lt;&lt;</code>的位运算符，但没见过<code>&gt;&gt;&gt;</code>估计意思差不多；</li>
<li><code>|=</code>运算符，目测是或；</li>
</ol>
</li>
<li><p>不知道写段代码测试吧</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"15的二进制数是   "</span>+ Integer.toBinaryString(<span class="number">15</span>));</div><div class="line">		System.out.println(<span class="string">"-15的二进制数是   "</span>+ Integer.toBinaryString(-<span class="number">15</span>));</div><div class="line">		System.out.println(<span class="string">"15 &gt;&gt; 2 的运算结果是    "</span> + (<span class="number">15</span> &gt;&gt; <span class="number">2</span>));</div><div class="line">		System.out.println(<span class="string">"15 &lt;&lt; 2 的运算结果是    "</span> + (<span class="number">15</span> &lt;&lt; <span class="number">2</span>));</div><div class="line">		System.out.println(<span class="string">"15 &gt;&gt;&gt; 2 的运算结果是    "</span> + (<span class="number">15</span> &gt;&gt;&gt; <span class="number">2</span>));</div><div class="line">		<span class="comment">//遗憾的是没有&lt;&lt;&lt;运算符,我的jdk是jdk1.8.0_144</span></div><div class="line">		<span class="comment">//System.out.println(15 &lt;&lt;&lt; 2);</span></div><div class="line">		System.out.println(<span class="string">"-15 &gt;&gt; 2 的运算结果是    "</span> + (-<span class="number">15</span> &gt;&gt; <span class="number">2</span>));</div><div class="line">		System.out.println(<span class="string">"-15 &lt;&lt; 2 的运算结果是    "</span> + (-<span class="number">15</span> &lt;&lt; <span class="number">2</span>));</div><div class="line">		System.out.println(<span class="string">"-15 &gt;&gt;&gt; 2 的运算结果是    "</span> + (-<span class="number">15</span> &gt;&gt;&gt; <span class="number">2</span>));</div><div class="line">		<span class="keyword">int</span> index = <span class="number">8</span>;</div><div class="line">		System.out.println(index + <span class="string">" | 15 &gt;&gt;&gt; 2的运算结果是   "</span> + (index | <span class="number">15</span> &gt;&gt;&gt; <span class="number">2</span>));</div><div class="line">		System.out.println(index + <span class="string">" |= 15 &gt;&gt;&gt; 2 的运算结果是    "</span> + (index |= <span class="number">15</span> &gt;&gt;&gt; <span class="number">2</span>));</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">15的二进制数是   1111</div><div class="line">-15的二进制数是   11111111111111111111111111110001</div><div class="line">15 &gt;&gt; 2 的运算结果是    3</div><div class="line">15 &lt;&lt; 2 的运算结果是    60</div><div class="line">15 &gt;&gt;&gt; 2 的运算结果是    3</div><div class="line">-15 &gt;&gt; 2 的运算结果是    -4</div><div class="line">-15 &lt;&lt; 2 的运算结果是    -60</div><div class="line">-15 &gt;&gt;&gt; 2 的运算结果是    1073741820</div><div class="line">8 | 3的运算结果是   11</div><div class="line">8 |= 15 &gt;&gt;&gt; 2 的运算结果是    11</div></pre></td></tr></table></figure>
</li>
<li><p>分析</p>
<ol>
<li><code>15 &gt;&gt; 2</code><br>15 的 二 进 制 表 示 00000000 00000000 00000000 00001111  正数补码反码都一样<br>得 -15的补码表示 11111111 11111111 11111111 11110001<br>将 15右移2位 00000000 00000000 00000000 00000011 得3  </li>
<li><code>-15 &gt;&gt; 2</code><br>将-15右移2位 11111111 11111111 11111111 11111100<br>在高位补1<br>保留符号位，然后按位取反<br>10000000 00000000 00000000 00000011<br>然后加1，即为所求数的原码：<br>10000000 00000000 00000000 00000100<br>所以 -15&gt;&gt;2 右移两位结果是 -4</li>
<li><code>&gt;&gt;&gt;</code> 符号结果是无符号规则右移  主要区别是在负数上面<br>-15的二进制表示 11111111 11111111 11111111 11110001<br>将-15右移2位， 在高位补0， 00111111 11111111 11111111 11111100<br>所得结果 1073741820  </li>
<li>从上面的结果可以看出 8|=15就是 8|15 就是或运算符，唯一的区别的就是temp = temp | temp1 等于 temp |= temp1，重新复习下与或非运算符：<ol>
<li><code>与运算</code>符用符号“&amp;”表示，其使用规律如下：<br>两个操作数中位都为1，结果才为1，否则结果为0，</li>
<li><code>或运算</code>符用符号“|”表示，其运算规律如下：<br>两个位只要有一个为1，那么结果就是1，否则就为0， </li>
<li><code>非运算</code>符用符号“~”表示，其运算规律如下：<br>如果位为0，结果是1，如果位为1，结果是0， </li>
<li><code>异或运算</code>是用符号“^”表示的，其运算规律是：<br>两个操作数的位中，相同则结果为0，不同则结果为1。</li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;1、 今天在读&lt;code&gt;ConcurrentHashMap&lt;/code&gt;的源码中突然发现一段很好玩的代码，大概理解它的意思。不多说上代码：
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="java" scheme="http://blog.wuwii.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>提升生活质量的日常方法</title>
    <link href="http://blog.wuwii.com/improve-lives-quality.html"/>
    <id>http://blog.wuwii.com/improve-lives-quality.html</id>
    <published>2017-08-04T02:08:03.000Z</published>
    <updated>2017-09-12T00:37:52.165Z</updated>
    
    <content type="html"><![CDATA[<h3 id="提升生活质量的日常方法"><a href="#提升生活质量的日常方法" class="headerlink" title="提升生活质量的日常方法"></a>提升生活质量的日常方法</h3><p>大方面那些什么学习、坚定梦想、诚恳、谦虚，进入大的圈子等等太大，在此记录下生活细节需要提升的。<br><img src="http://ov62kaxkk.bkt.clouddn.com/1ad5ad6eddc451dae80256afb6fd5266d11632f9.jpg" alt="image"></p>
<a id="more"></a>
<h5 id="每天整理桌子"><a href="#每天整理桌子" class="headerlink" title="每天整理桌子"></a>每天整理桌子</h5><p>// 坚持啊，桌子每次都乱 ，</p>
<h5 id="至少每周要彻底打扫次卫生"><a href="#至少每周要彻底打扫次卫生" class="headerlink" title="至少每周要彻底打扫次卫生"></a>至少每周要彻底打扫次卫生</h5><p>// 反正我要赤脚  </p>
<h5 id="床单、被子每个月最好洗一次，晒一次"><a href="#床单、被子每个月最好洗一次，晒一次" class="headerlink" title="床单、被子每个月最好洗一次，晒一次"></a>床单、被子每个月最好洗一次，晒一次</h5><p>// 作为个工科男，最不爱做的卫生就是这个了 恍惚恍惚  (逃:<br>//1708 没办到  </p>
<h5 id="理发，一个月一次"><a href="#理发，一个月一次" class="headerlink" title="理发，一个月一次"></a>理发，一个月一次</h5><p>// 哈哈，我的头发生长旺盛，一般一个月</p>
<h5 id="坚持锻炼"><a href="#坚持锻炼" class="headerlink" title="坚持锻炼"></a>坚持锻炼</h5><p>// 好的身体才能做其他的事情，最最重要的。。。</p>
<h5 id="出门最好带个伞"><a href="#出门最好带个伞" class="headerlink" title="出门最好带个伞"></a>出门最好带个伞</h5><p>// 结果回来伞就没了 。。。</p>
<h5 id="多读点书，多学习"><a href="#多读点书，多学习" class="headerlink" title="多读点书，多学习"></a>多读点书，多学习</h5><p>// 虽然经常去图书馆，但是读书不是我的目的啊，超难。。。  但是不得不说读书是有好处的，这个没有终点，需要保持才行，像我们这种IT男，好难坚持做这个，忙的要死。。。</p>
<p>// 学习是必须的，加油。 gdvl</p>
<h5 id="唱歌"><a href="#唱歌" class="headerlink" title="唱歌"></a>唱歌</h5><p>// mmp，像我这种五音不全得是不是没救了  </p>
<p>// 没打游戏了，可以练习下，有大神走过来，可以教我啊啊啊，请加我，联系，万分感谢。。</p>
<h5 id="做菜"><a href="#做菜" class="headerlink" title="做菜"></a>做菜</h5><p>// 大部分时候被大厨室友承包了，</p>
<p>// 感觉男同袍做菜，貌似只看能不能吃，哈哈 ，逃，不要打我我</p>
<p>// 是的要做得好点才行，不然就一尘不变了，没意义。。</p>
<h5 id="少打游戏"><a href="#少打游戏" class="headerlink" title="少打游戏"></a>少打游戏</h5><p>// 戒了，戒了，不要跟我谈游戏了。。 </p>
<p>不然我会跟一直谈下去的。。。 </p>
<p>// 不知道以前那么多年，怎么这么大的瘾在打游戏上面，现在，失去的太多，不知道我还能不能追回来。。加油boy…</p>
<h5 id="关于洗碗机"><a href="#关于洗碗机" class="headerlink" title="关于洗碗机"></a>关于洗碗机</h5><p>// 好东西啊啊，可惜现在好贵 最便宜也要3000大洋，要赚钱了  </p>
<h5 id="每天一个苹果吧"><a href="#每天一个苹果吧" class="headerlink" title="每天一个苹果吧"></a>每天一个苹果吧</h5><p>// 今年牙齿上做了手术，估计好长段时间不能吃啊，口水.jpg，<br>// 说到苹果，是不要个削苹果的，到时候淘宝吧。</p>
<blockquote>
<p>欢迎有人给我提意见，万分感谢！！！</p>
</blockquote>
<p>(To Be Continue:  </p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;提升生活质量的日常方法&quot;&gt;&lt;a href=&quot;#提升生活质量的日常方法&quot; class=&quot;headerlink&quot; title=&quot;提升生活质量的日常方法&quot;&gt;&lt;/a&gt;提升生活质量的日常方法&lt;/h3&gt;&lt;p&gt;大方面那些什么学习、坚定梦想、诚恳、谦虚，进入大的圈子等等太大，在此记录下生活细节需要提升的。&lt;br&gt;&lt;img src=&quot;http://ov62kaxkk.bkt.clouddn.com/1ad5ad6eddc451dae80256afb6fd5266d11632f9.jpg&quot; alt=&quot;image&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="碎碎念" scheme="http://blog.wuwii.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
      <category term="生活" scheme="http://blog.wuwii.com/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>念</title>
    <link href="http://blog.wuwii.com/fetter-tears.html"/>
    <id>http://blog.wuwii.com/fetter-tears.html</id>
    <published>2017-07-18T14:08:03.000Z</published>
    <updated>2017-09-08T09:00:51.729Z</updated>
    
    <content type="html"><![CDATA[<p>夜总是格外的静，月光就可以通过窗户观赏我这残酷的心情了。  </p>
<p>想想过去，我有好几年都没跟你见过面，即使是聊天也是随意的说说，心中确实有写隔阂，没有以前那么天真，忧伤了。现在节奏太快了现在做事都是太认真了，总是考虑会不会有结果，渐渐的失去了一些目标，一些梦想，一些人。</p>
<p>事情总是那么凑巧，这个时候室友都封闭开发去，需要一个人，偌大的房间留个我一个人享受，想可以慢慢的在这里疗伤了，是的，下班后，比往常安静了，没以前在一起讲段子的欢声，骂做的菜真难吃，米是不是又没有煮·····现在只剩下我每天做一个菜，煮一碗米，一个人在吃饭，夜真是寂静的无聊，只有这个残酷的月光能在一旁陪伴。</p>
<p>真的想，一个人静静的吃饭。得不到可能就是最好的结果，毕竟这么长时间都没有联系过的人，早就应该消失的人，为什么还要在她幸福的时刻出现。</p>
<p>难以启齿，大道理真的没几个人能说的清楚，但是我还是清楚心中所想，只是心底还是存在那么一些执念，不愿意放下罢了，估计今生也没那么容易放下吧。</p>
<p>但是，人总是要往前走的，也不能一直活在这个回忆里去放弃，要努力前行。有可能时间不会让我忘记，只是削弱它的程度，它的悲伤吧。</p>
<p>曾经看到你的签名，想要制造羁绊，就必须要承担流泪的风险，我不太清楚你心中所想，也不懂你，这么多年了没见，每个人都发生了无数的可能。这句话我看出来，你是真的想找到爱情，而且已经可能找到了对的人了，成了一段绚丽多彩的美丽故事。</p>
<p>我可能是个执着的傻瓜，总是伤害到人，最终也伤害到自己了；我也是追求完美的人，都只去接触身边符合自己的人。所以总是这个患得患失的状态。我想上面这句话来形容我最好的了，选择来到了这个世界，就应该住在这里，与它融合，影响它，不必去选择什么对与错。可能会很痛，可能会是错误的道路，但那样生活就会不一样的精彩，不是吗？我希望不在抗拒这个世界带来的美好，也不去害怕去开辟新的人生。</p>
<p>我查到这句话来自《小王子》，对啊，你就是我的世界里独一无二的，我对你来说，也将是你的世界的唯一了。虽然每个人都有可能成为路人甲，但是人生不就是这样的吗？ </p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;夜总是格外的静，月光就可以通过窗户观赏我这残酷的心情了。  &lt;/p&gt;
&lt;p&gt;想想过去，我有好几年都没跟你见过面，即使是聊天也是随意的说说，心中确实有写隔阂，没有以前那么天真，忧伤了。现在节奏太快了现在做事都是太认真了，总是考虑会不会有结果，渐渐的失去了一些目标，一些梦想，一
    
    </summary>
    
      <category term="碎碎念" scheme="http://blog.wuwii.com/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
      <category term="心情" scheme="http://blog.wuwii.com/tags/%E5%BF%83%E6%83%85/"/>
    
  </entry>
  
  <entry>
    <title>搭建fastDFS单实例服务器</title>
    <link href="http://blog.wuwii.com/centos-fastDFS.html"/>
    <id>http://blog.wuwii.com/centos-fastDFS.html</id>
    <published>2017-07-18T02:08:03.000Z</published>
    <updated>2017-09-05T09:11:35.694Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p><code>FastDFS</code>是一个开源的轻量级分布式文件系统，它对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合以文件为载体的在线服务，如相册网站、视频网站等等。</p>
</blockquote>
<a id="more"></a>  
<blockquote>
<p><code>FastDFS</code>为互联网量身定制，充分考虑了冗余备份、负载均衡、线性扩容等机制，并注重高可用、高性能等指标，使用FastDFS很容易搭建一套高性能的文件服务器集群提供文件上传、下载等服务。</p>
<p><code>FastDFS</code>服务端有两个角色：跟踪器<code>tracker</code>和存储节点<code>storage</code>。跟踪器主要做调度工作，在访问上起负载均衡的作用。</p>
</blockquote>
<h2 id="安装并配置FastDFS"><a href="#安装并配置FastDFS" class="headerlink" title="安装并配置FastDFS"></a>安装并配置FastDFS</h2><h3 id="运行环境及相关软件"><a href="#运行环境及相关软件" class="headerlink" title="运行环境及相关软件"></a>运行环境及相关软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CentOS 7.0</div><div class="line">FastDFS_v5.08.tar.gz</div><div class="line">nginx-1.8.1.tar.gz</div><div class="line">fastdfs-nginx-module_v1.16.tar.gz</div><div class="line">libfastcommon</div></pre></td></tr></table></figure>
<h3 id="服务器规划"><a href="#服务器规划" class="headerlink" title="服务器规划"></a>服务器规划</h3><table>
<thead>
<tr>
<th>服务器名称</th>
<th>IP地址及端口</th>
<th>备注 </th>
</tr>
</thead>
<tbody>
<tr>
<td>fastdfs-tracker</td>
<td>192.168.114.128:22122</td>
<td>跟踪服务器/调度服务器</td>
</tr>
<tr>
<td>fastdfs-storage</td>
<td>192.168.114.128:23000</td>
<td>存储服务器 </td>
</tr>
</tbody>
</table>
<h3 id="安装FastDFS"><a href="#安装FastDFS" class="headerlink" title="安装FastDFS"></a>安装FastDFS</h3><h4 id="首先创建工具目录（非必须）"><a href="#首先创建工具目录（非必须）" class="headerlink" title="首先创建工具目录（非必须）"></a>首先创建工具目录（非必须）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># mkdir -p /home/oldcat/tools</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># cd /home/oldcat/tools/</span></div></pre></td></tr></table></figure>
<h4 id="下载并安装FastDFS依赖包libfastcommon"><a href="#下载并安装FastDFS依赖包libfastcommon" class="headerlink" title="下载并安装FastDFS依赖包libfastcommon"></a>下载并安装FastDFS依赖包libfastcommon</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage tools]<span class="comment"># wget https://codeload.github.com/happyfish100/libfastcommon/zip/master</span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># unzip master</span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># cd libfastcommon-master/</span></div><div class="line">[root@fastdfs-storage libfastcommon-master]<span class="comment"># ls</span></div><div class="line">HISTORY  INSTALL  libfastcommon.spec  make.sh  php-fastcommon  README  src</div><div class="line">[root@fastdfs-storage libfastcommon-master]<span class="comment"># ./make.sh</span></div><div class="line">[root@fastdfs-storage libfastcommon-master]<span class="comment"># ./make.sh install</span></div></pre></td></tr></table></figure>
<h4 id="下载并安装FastDFS"><a href="#下载并安装FastDFS" class="headerlink" title="下载并安装FastDFS"></a>下载并安装FastDFS</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker tools]<span class="comment"># wget http://jaist.dl.sourceforge.net/project/fastdfs/FastDFS%20Server%20Source%20Code/FastDFS%20Server%20with%20PHP%20Extension%20Source%20Code%20V5.08/FastDFS_v5.08.tar.gz</span></div><div class="line">[root@fastdfs-tracker tools]<span class="comment"># tar xf FastDFS_v5.08.tar.gz</span></div><div class="line">[root@fastdfs-tracker tools]<span class="comment"># cd FastDFS</span></div><div class="line">[root@fastdfs-tracker FastDFS]<span class="comment"># ./make.sh &amp;&amp; ./make.sh install</span></div></pre></td></tr></table></figure>
<h4 id="采用默认方式安装后的文件及目录："><a href="#采用默认方式安装后的文件及目录：" class="headerlink" title="采用默认方式安装后的文件及目录："></a>采用默认方式安装后的文件及目录：</h4><h5 id="服务脚本："><a href="#服务脚本：" class="headerlink" title="服务脚本："></a>服务脚本：</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># ll /etc/init.d/ |grep fdfs</span></div><div class="line">-rwxr-xr-x. 1 root root   918 4月  22 22:08 fdfs_storaged</div><div class="line">-rwxr-xr-x. 1 root root   920 4月  22 22:08 fdfs_trackerd</div></pre></td></tr></table></figure>
<h5 id="样例配置文件"><a href="#样例配置文件" class="headerlink" title="样例配置文件"></a>样例配置文件</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># ll /etc/fdfs/</span></div><div class="line">总用量 20</div><div class="line">-rw-r--r--. 1 root root 1461 4月  22 22:08 client.conf.sample</div><div class="line">-rw-r--r--. 1 root root 7927 4月  22 22:08 storage.conf.sample</div><div class="line">-rw-r--r--. 1 root root 7200 4月  22 22:08 tracker.conf.sample</div></pre></td></tr></table></figure>
<h5 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># ll /usr/bin|grep fdfs</span></div><div class="line">-rwxr-xr-x.   1 root root     252272 4月  22 22:08 fdfs_appender_test</div><div class="line">-rwxr-xr-x.   1 root root     252225 4月  22 22:08 fdfs_appender_test1</div><div class="line">-rwxr-xr-x.   1 root root     242449 4月  22 22:08 fdfs_append_file</div><div class="line">-rwxr-xr-x.   1 root root     242013 4月  22 22:08 fdfs_crc32</div><div class="line">-rwxr-xr-x.   1 root root     242508 4月  22 22:08 fdfs_delete_file</div><div class="line">-rwxr-xr-x.   1 root root     243627 4月  22 22:08 fdfs_download_file</div><div class="line">-rwxr-xr-x.   1 root root     243369 4月  22 22:08 fdfs_file_info</div><div class="line">-rwxr-xr-x.   1 root root     255657 4月  22 22:08 fdfs_monitor</div><div class="line">-rwxr-xr-x.   1 root root     863913 4月  22 22:08 fdfs_storaged</div><div class="line">-rwxr-xr-x.   1 root root     258712 4月  22 22:08 fdfs_test</div><div class="line">-rwxr-xr-x.   1 root root     257881 4月  22 22:08 fdfs_test1</div><div class="line">-rwxr-xr-x.   1 root root     365232 4月  22 22:08 fdfs_trackerd</div><div class="line">-rwxr-xr-x.   1 root root     243547 4月  22 22:08 fdfs_upload_appender</div><div class="line">-rwxr-xr-x.   1 root root     244453 4月  22 22:08 fdfs_upload_file</div></pre></td></tr></table></figure>
<h3 id="配置跟踪服务器（tracker-server）"><a href="#配置跟踪服务器（tracker-server）" class="headerlink" title="配置跟踪服务器（tracker server）"></a>配置跟踪服务器（tracker server）</h3><h4 id="拷贝tracker-server和client端样例配置文件并重命名"><a href="#拷贝tracker-server和client端样例配置文件并重命名" class="headerlink" title="拷贝tracker server和client端样例配置文件并重命名"></a>拷贝tracker server和client端样例配置文件并重命名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># cp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /etc/fdfs/client.conf.sample /etc/fdfs/client.conf</span></div></pre></td></tr></table></figure>
<h4 id="编辑tracker-server配置文件tracker-conf，需要修改内容如下："><a href="#编辑tracker-server配置文件tracker-conf，需要修改内容如下：" class="headerlink" title="编辑tracker server配置文件tracker.conf，需要修改内容如下："></a>编辑tracker server配置文件tracker.conf，需要修改内容如下：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">disabled=<span class="literal">false</span>（默认为<span class="literal">false</span>，表示是否无效）</div><div class="line">port=22122（默认为22122）</div><div class="line">base_path=/data/fastdfs/tracker</div></pre></td></tr></table></figure>
<h4 id="编辑client端的配置文件client-conf，需要修改内容如下"><a href="#编辑client端的配置文件client-conf，需要修改内容如下" class="headerlink" title="编辑client端的配置文件client.conf，需要修改内容如下"></a>编辑client端的配置文件client.conf，需要修改内容如下</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">base_path=/data/fastdfs/tracker</div><div class="line">tracker_server=172.18.10.232:22122</div></pre></td></tr></table></figure>
<h4 id="创建tracker-server数据目录"><a href="#创建tracker-server数据目录" class="headerlink" title="创建tracker server数据目录"></a>创建tracker server数据目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># mkdir -p /data/fastdfs/tracker</span></div></pre></td></tr></table></figure>
<h4 id="测试启动tracker-server，启动成功会自动在-data-fastdfs-tracker目录新建data和logs目录"><a href="#测试启动tracker-server，启动成功会自动在-data-fastdfs-tracker目录新建data和logs目录" class="headerlink" title="测试启动tracker server，启动成功会自动在/data/fastdfs/tracker目录新建data和logs目录"></a>测试启动tracker server，启动成功会自动在/data/fastdfs/tracker目录新建data和logs目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># cd /data/fastdfs/tracker/</span></div><div class="line">[root@fastdfs-tracker tracker]<span class="comment"># ls</span></div><div class="line">[root@fastdfs-tracker tracker]<span class="comment"># /etc/init.d/fdfs_trackerd start</span></div><div class="line">Starting FastDFS tracker server:</div><div class="line">[root@fastdfs-tracker tracker]<span class="comment"># ss -lntup|grep 22122</span></div><div class="line">tcp    LISTEN     0      128                    *:22122                 *:*      users:((<span class="string">"fdfs_trackerd"</span>,3785,5)) </div><div class="line">[root@fastdfs-tracker tracker]<span class="comment"># ls</span></div><div class="line">data  logs</div></pre></td></tr></table></figure>
<h4 id="关闭tracker-server-目前可以不使用"><a href="#关闭tracker-server-目前可以不使用" class="headerlink" title="关闭tracker server(目前可以不使用)"></a>关闭tracker server(目前可以不使用)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker tracker]<span class="comment"># /etc/init.d/fdfs_trackerd stop</span></div><div class="line">waiting <span class="keyword">for</span> pid [3785] <span class="built_in">exit</span> ...</div><div class="line">pid [3785] <span class="built_in">exit</span>.</div></pre></td></tr></table></figure>
<h3 id="配置存储服务器（storage-server）"><a href="#配置存储服务器（storage-server）" class="headerlink" title="配置存储服务器（storage server）"></a>配置存储服务器（storage server）</h3><h4 id="拷贝storage-server样例配置文件并重命名"><a href="#拷贝storage-server样例配置文件并重命名" class="headerlink" title="拷贝storage server样例配置文件并重命名"></a>拷贝storage server样例配置文件并重命名</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf</span></div></pre></td></tr></table></figure>
<h4 id="编辑storage-server配置文件storage-conf，需要修改内容如下："><a href="#编辑storage-server配置文件storage-conf，需要修改内容如下：" class="headerlink" title="编辑storage server配置文件storage.conf，需要修改内容如下："></a>编辑storage server配置文件storage.conf，需要修改内容如下：</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">disabled=<span class="literal">false</span>（默认为<span class="literal">false</span>，表示是否无效）</div><div class="line">port=23000（默认为23000）</div><div class="line">base_path=/data/fastdfs/storage</div><div class="line">tracker_server=172.18.10.232:22122</div><div class="line">store_path0=/data/fastdfs/storage</div><div class="line">http.server_port=8888（默认为8888，nginx中配置的监听端口那之一致）</div></pre></td></tr></table></figure>
<h4 id="创建storage-server数据目录"><a href="#创建storage-server数据目录" class="headerlink" title="创建storage server数据目录"></a>创建storage server数据目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># mkdir -p /data/fastdfs/storage</span></div></pre></td></tr></table></figure>
<h4 id="测试启动storage-server，启动成功会自动在-data-fastdfs-tracker目录新建data和logs目录（启动storage-server的前提是tracker-server必须事先已启动）"><a href="#测试启动storage-server，启动成功会自动在-data-fastdfs-tracker目录新建data和logs目录（启动storage-server的前提是tracker-server必须事先已启动）" class="headerlink" title="测试启动storage server，启动成功会自动在/data/fastdfs/tracker目录新建data和logs目录（启动storage server的前提是tracker server必须事先已启动）"></a>测试启动storage server，启动成功会自动在/data/fastdfs/tracker目录新建data和logs目录（启动storage server的前提是tracker server必须事先已启动）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># cd /data/fastdfs/storage/</span></div><div class="line">[root@fastdfs-storage storage]<span class="comment"># ls</span></div><div class="line">[root@fastdfs-storage storage]<span class="comment"># /etc/init.d/fdfs_storaged start</span></div><div class="line">Starting FastDFS storage server:</div><div class="line">[root@fastdfs-storage storage]<span class="comment"># ss -lntup|grep 23000</span></div><div class="line">tcp    LISTEN     0      128                    *:23000                 *:*      users:((<span class="string">"fdfs_storaged"</span>,3786,5))</div><div class="line">[root@fastdfs-storage storage]<span class="comment"># ls</span></div><div class="line">data  logs</div></pre></td></tr></table></figure>
<h4 id="验证storage是否登记到tracker服务器"><a href="#验证storage是否登记到tracker服务器" class="headerlink" title="验证storage是否登记到tracker服务器~"></a>验证storage是否登记到tracker服务器~</h4><ul>
<li>使用/usr/bin/fdfs_monitor /etc/fdfs/storage.conf，运行fdfs_monitor查看storage服务器是否已经登记到tracker服务器。</li>
<li>如果出现ip_addr = <ip> Active, 则表明storage服务器已经登记到tracker服务器~</ip></li>
<li>Storage 1:<br>  id = 192.168.0.1<br>  ip_addr = 192.168.0.1  ==ACTIVE==<h3 id="文件上传测试"><a href="#文件上传测试" class="headerlink" title="文件上传测试"></a>文件上传测试</h3><ul>
<li>执行如下上传命令：<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-tracker ~]<span class="comment"># /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /etc/fdfs/client.conf</span></div><div class="line">group1/M00/00/00/rBIK6VcaP0aARXXvAAHrUgHEviQ394.conf</div><div class="line">返回文件ID即说明文件已经上传成功</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="存储服务器（storage-server）安装并配置nginx"><a href="#存储服务器（storage-server）安装并配置nginx" class="headerlink" title="存储服务器（storage server）安装并配置nginx"></a>存储服务器（storage server）安装并配置nginx</h2><h3 id="下载并安装fastdfs-nginx-module模块"><a href="#下载并安装fastdfs-nginx-module模块" class="headerlink" title="下载并安装fastdfs-nginx-module模块"></a>下载并安装fastdfs-nginx-module模块</h3><blockquote>
<p><code>FastDFS</code>通过<code>Tracker</code>服务器,将文件放在<code>Storage</code>服务器存储，但是同组存储服务器之间需要进入文件复制，有同步延迟的问题。假设Tracker服务器将文件上传到了192.168.4.125，上传成功后文件ID已经返回给客户端。此时FastDFS存储集群机制会将这个文件同步到同组存储192.168.4.126，在文件还没有复制完成的情况下，客户端如果用这个文件ID在192.168.4.126上取文件,就会出现文件无法访问的错误。而fastdfs-nginx-module可以重定向文件连接到源服务器取文件,避免客户端由于复制延迟导致的文件无法访问错误。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage  tools]<span class="comment"># wget http://nchc.dl.sourceforge.net/project/fastdfs/FastDFS%20Nginx%20Module%20Source%20Code/fastdfs-nginx-module_v1.16.tar.gz</span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># tar xf fastdfs-nginx-module_v1.16.tar.gz </span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># cd fastdfs-nginx-module/src/</span></div><div class="line">[root@fastdfs-storage src]<span class="comment"># vim config</span></div><div class="line">编辑config文件，执行如下命令进行批量替换并保存退出</div><div class="line">:%s+/usr/<span class="built_in">local</span>/+/usr/+g</div></pre></td></tr></table></figure>
<h3 id="拷贝fastdfs-nginx-module模块中配置文件到-etc-fdfs目录中并编辑"><a href="#拷贝fastdfs-nginx-module模块中配置文件到-etc-fdfs目录中并编辑" class="headerlink" title="拷贝fastdfs-nginx-module模块中配置文件到/etc/fdfs目录中并编辑"></a>拷贝fastdfs-nginx-module模块中配置文件到/etc/fdfs目录中并编辑</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /home/oldcat/tools/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># vim /etc/fdfs/mod_fastdfs.conf</span></div><div class="line">修改内容如下：</div><div class="line">connect_timeout=10</div><div class="line">base_path=/tmp（默认为/tmp）</div><div class="line">tracker_server=172.18.10.232:22122</div><div class="line">storage_server_port=23000（默认配置为23000）</div><div class="line">url_have_group_name = <span class="literal">true</span></div><div class="line">store_path0=/data/fastdfs/storage</div><div class="line">group_name=group1（默认配置为group1）</div></pre></td></tr></table></figure>
<h3 id="安装nginx依赖库（必须要检查）"><a href="#安装nginx依赖库（必须要检查）" class="headerlink" title="安装nginx依赖库（必须要检查）"></a>安装nginx依赖库（必须要检查）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage nginx-1.8.1]<span class="comment"># yum install -y pcre-devel zlib-devel</span></div></pre></td></tr></table></figure>
<h3 id="下载并安装nginx"><a href="#下载并安装nginx" class="headerlink" title="下载并安装nginx"></a>下载并安装nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage  tools]<span class="comment"># wget http://nginx.org/download/nginx-1.8.1.tar.gz</span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># tar xf nginx-1.8.1.tar.gz </span></div><div class="line">[root@fastdfs-storage tools]<span class="comment"># cd nginx-1.8.1</span></div><div class="line">[root@fastdfs-storage nginx-1.8.1]<span class="comment"># ./configure --prefix=/application/nginx/ --add-module=../fastdfs-nginx-module/src/</span></div><div class="line">[root@fastdfs-storage nginx-1.8.1]<span class="comment"># make &amp;&amp; make install</span></div></pre></td></tr></table></figure>
<h3 id="拷贝FastDFS中的部分配置文件到-etc-fdfs目录中"><a href="#拷贝FastDFS中的部分配置文件到-etc-fdfs目录中" class="headerlink" title="拷贝FastDFS中的部分配置文件到/etc/fdfs目录中"></a>拷贝FastDFS中的部分配置文件到/etc/fdfs目录中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /home/oldcat/tools/FastDFS/conf/http.conf /etc/fdfs/</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /home/oldcat/tools/FastDFS/conf/mime.types /etc/fdfs/</span></div></pre></td></tr></table></figure>
<h3 id="配置nginx，如下所示："><a href="#配置nginx，如下所示：" class="headerlink" title="配置nginx，如下所示："></a>配置nginx，如下所示：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># vim /application/nginx/conf/nginx.conf</span></div><div class="line">    user  root;    </div><div class="line">    worker_processes  1;</div><div class="line">    events &#123;</div><div class="line">       worker_connections  1024;</div><div class="line">    &#125;</div><div class="line">    http &#123;</div><div class="line">        include       mime.types;</div><div class="line">        default_type  application/octet-stream;</div><div class="line">        sendfile        on;</div><div class="line">        keepalive_timeout  65;</div><div class="line">        server &#123;</div><div class="line">            listen       8888;</div><div class="line">            server_name  localhost;</div><div class="line">            location / &#123;</div><div class="line">                root   html;</div><div class="line">                index  index.html index.htm;</div><div class="line">            &#125;</div><div class="line">            location ~/group[0-9]/M00 &#123;</div><div class="line">                root /data/fastdfs/storage/data/;</div><div class="line">                ngx_fastdfs_module;</div><div class="line">            &#125;</div><div class="line">            error_page   500 502 503 504  /50x.html;</div><div class="line">            location = /50x.html &#123;</div><div class="line">            root   html;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h3><p>a、<code>user root</code>是解决下载操作时报404的问题<br>b、<code>8888</code>端口号与<code>/etc/fdfs/storage.conf</code>中的<code>http.server_port=8888</code>相对应<br>c、<code>storage</code>对应有多个group的情况下，访问路径带group名称，例如：<code>/group1/M00/00/00/**</code>，对应nginx配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">location ~/group[0-9]/ &#123;</div><div class="line">       ngx_fastdfs_module;</div><div class="line"> &#125;</div></pre></td></tr></table></figure></p>
<h3 id="创建M00至storage存储目录的符号连接："><a href="#创建M00至storage存储目录的符号连接：" class="headerlink" title="创建M00至storage存储目录的符号连接："></a>创建M00至storage存储目录的符号连接：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -sv /data/fastdfs/storage/data  /data/fastdfs/storage/data/M00</div></pre></td></tr></table></figure>
<h3 id="拷贝nginx服务到-etc-init-d-目录下并启动"><a href="#拷贝nginx服务到-etc-init-d-目录下并启动" class="headerlink" title="拷贝nginx服务到/etc/init.d/目录下并启动"></a>拷贝nginx服务到/etc/init.d/目录下并启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@fastdfs-storage ~]<span class="comment"># cp /application/nginx/sbin/nginx /etc/init.d/</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># /etc/init.d/nginx</span></div><div class="line">[root@fastdfs-storage ~]<span class="comment"># ss -lntup|grep 8888</span></div><div class="line">tcp    LISTEN     0      128                    *:8888                  *:*      users:((<span class="string">"nginx"</span>,7308,6),(<span class="string">"nginx"</span>,7309,6))</div></pre></td></tr></table></figure>
<hr>
<h2 id="防火墙端口设置"><a href="#防火墙端口设置" class="headerlink" title="防火墙端口设置"></a>防火墙端口设置</h2><h3 id="查看已开启的端口："><a href="#查看已开启的端口：" class="headerlink" title="查看已开启的端口："></a>查看已开启的端口：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@localhost nginx-1.12.0]<span class="comment"># firewall-cmd --zone=public --list-ports</span></div><div class="line">20880/tcp 80/tcp 2181/tcp 23000/tcp 22122/tcp 9999/tcp</div><div class="line">[root@localhost nginx-1.12.0]<span class="comment">#</span></div></pre></td></tr></table></figure>
<h3 id="开放端口号命令：–permanent表示永久生效，不加的话，重启后不生效"><a href="#开放端口号命令：–permanent表示永久生效，不加的话，重启后不生效" class="headerlink" title="开放端口号命令：–permanent表示永久生效，不加的话，重启后不生效"></a>开放端口号命令：–permanent表示永久生效，不加的话，重启后不生效</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo firewall-cmd --zone=public --add-port=23000/tcp --permanent <span class="comment">#开户端口号</span></div><div class="line">sudo firewall-cmd --reload</div></pre></td></tr></table></figure>
<h3 id="CentOS7-防火墙相关命令："><a href="#CentOS7-防火墙相关命令：" class="headerlink" title="CentOS7 防火墙相关命令："></a>CentOS7 防火墙相关命令：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">systemctl <span class="built_in">enable</span> firewalld.service    <span class="comment">#开启防火墙</span></div><div class="line">systemctl stop firewalld.service     <span class="comment">#关闭防火墙(开机会仍会启动)</span></div><div class="line">systemctl <span class="built_in">disable</span> firewalld.service  <span class="comment">#禁用防火墙(开机后不再启动)</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="添加开机自启"><a href="#添加开机自启" class="headerlink" title="添加开机自启"></a>添加开机自启</h2><h3 id="首先检查-etc-rc-d-rc-local-是否有执行权限"><a href="#首先检查-etc-rc-d-rc-local-是否有执行权限" class="headerlink" title="首先检查 /etc/rc.d/rc.local  是否有执行权限"></a>首先检查 <code>/etc/rc.d/rc.local</code>  是否有执行权限</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ll /etc/rc.d/rc.local</div><div class="line">-rwxr--r-x. 1 root root 550 8月  18 10:58 /etc/rc.d/rc.local</div><div class="line">user 有x有执行权限，没有则执行</div><div class="line">chmod u+x /etc/rc.d/rc.local</div></pre></td></tr></table></figure>
<h3 id="在-etc-rc-d-rc-local-最底下加上服务器启动命令"><a href="#在-etc-rc-d-rc-local-最底下加上服务器启动命令" class="headerlink" title="在 /etc/rc.d/rc.local 最底下加上服务器启动命令"></a>在 <code>/etc/rc.d/rc.local</code> 最底下加上服务器启动命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/fdfs_trackerd start  </div><div class="line">/etc/init.d/fdfs_storaged start  </div><div class="line">/etc/init.d/nginx</div></pre></td></tr></table></figure>
<h3 id="查看服务启动"><a href="#查看服务启动" class="headerlink" title="查看服务启动"></a>查看服务启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[root@localhost ~]<span class="comment"># netstat -unltp|grep fdfs</span></div><div class="line">tcp        0      0 0.0.0.0:22122           0.0.0.0:*               LISTEN      1239/fdfs_trackerd  </div><div class="line">tcp        0      0 0.0.0.0:23000           0.0.0.0:*               LISTEN      1245/fdfs_storaged  </div><div class="line">[root@localhost ~]<span class="comment"># netstat -unltp|grep nginx</span></div><div class="line">tcp        0      0 0.0.0.0:8888            0.0.0.0:*               LISTEN      1278/nginx: master</div></pre></td></tr></table></figure>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;FastDFS&lt;/code&gt;是一个开源的轻量级分布式文件系统，它对文件进行管理，功能包括：文件存储、文件同步、文件访问（文件上传、文件下载）等，解决了大容量存储和负载均衡的问题。特别适合以文件为载体的在线服务，如相册网站、视频网站等等。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="学习笔记" scheme="http://blog.wuwii.com/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="linux" scheme="http://blog.wuwii.com/tags/linux/"/>
    
      <category term="fastDFS" scheme="http://blog.wuwii.com/tags/fastDFS/"/>
    
  </entry>
  
  <entry>
    <title>测试</title>
    <link href="http://blog.wuwii.com/test.html"/>
    <id>http://blog.wuwii.com/test.html</id>
    <published>2017-07-04T02:08:03.000Z</published>
    <updated>2017-09-08T06:26:36.096Z</updated>
    
    <content type="html"><![CDATA[<p>来到这个世界，被筛选，被挑剔，被赋予使命。我们被杀死，中途夭折，轻易放弃，多次失败，多次重头再来。变成暴躁的炸弹，变成美丽的花，我们恶心难堪，又美丽动人，充满希望，却又满是不堪。你用悲伤去看，这是一个充满死亡的地方。你用努力去看，这里充满了永不停歇的希望，人们都带着笑。诸君共勉<br><a id="more"></a></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="测试1"><a href="#测试1" class="headerlink" title="测试1"></a>测试1</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;来到这个世界，被筛选，被挑剔，被赋予使命。我们被杀死，中途夭折，轻易放弃，多次失败，多次重头再来。变成暴躁的炸弹，变成美丽的花，我们恶心难堪，又美丽动人，充满希望，却又满是不堪。你用悲伤去看，这是一个充满死亡的地方。你用努力去看，这里充满了永不停歇的希望，人们都带着笑。诸君共勉&lt;br&gt;
    
    </summary>
    
      <category term="测试" scheme="http://blog.wuwii.com/categories/%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="测试下" scheme="http://blog.wuwii.com/tags/%E6%B5%8B%E8%AF%95%E4%B8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://blog.wuwii.com/hello-world.html"/>
    <id>http://blog.wuwii.com/hello-world.html</id>
    <published>2017-07-03T02:08:03.000Z</published>
    <updated>2017-09-05T00:56:13.720Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
    
    </summary>
    
      <category term="测试" scheme="http://blog.wuwii.com/categories/%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="测试下" scheme="http://blog.wuwii.com/tags/%E6%B5%8B%E8%AF%95%E4%B8%8B/"/>
    
  </entry>
  
</feed>
